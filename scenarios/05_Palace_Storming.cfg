[scenario]
    id = 05_Storming_the_Palace
    name = _"05 Storming the Palace"
    next_scenario = 06_Epilogue    

    map_file = 05_Storming_the_Palace.map
    turns = -1
    {NW_FULL_DAY}

    #After 24 houres loyalist forces will arraive regularly

    #Szenario Intro
    [story]
        [part]
            show_title=yes
            story = _ "Crossing many a field. At first the promise of the clans seemed to be true, marching trough the clans land they were unperturbted, every village the found along the road was vacant. Until finally their luck turned, only a few leageus north of weldyn, and the royal palace. 
            
(1/2)" 
        [/part]
    [/story]
#----------

    #Sides #Give all L2+ units from recall list, also give all loyal trait, then only allow recalling
    #Tragtrad
    [side]
        type=Bloodthorn Orcish Leader
        id=Tragtrad
        side=1
        recruit=Orcish Crossbowman,Orcish Warrior
        controller=human
        team_name=orcs
        {GOLD 0 0 0}
        {INCOME -2 -2 -2}
    [/side]

    #Wesnoth King let move along walls TODO
    [side]
        type=WOTG_King
        id=King
        name= _ "King Letarg"
        side=2
        canrecruit=yes
        team_name=wesnoth
        recruit=
        {GOLD 300 300 300}
        {INCOME -2 -2 -2}
        [ai]
            passive_leader=yes
        [/ai]

		[village]
			x=3
			y=52
		[/village]

		[village]
			x=7
			y=51
		[/village]

		[village]
			x=10
			y=52
		[/village]

		[village]
			x=11
			y=51
		[/village]

		[village]
			x=13
			y=50
		[/village]

		[village]
			x=15
			y=51
		[/village]

		[village]
			x=16
			y=52
		[/village]

		[village]
			x=19
			y=51
		[/village]

		[village]
			x=23
			y=52
		[/village]
    [/side]

    #protecting Generals 1
    [side]
        type=Grand Marshal
        id=Heford
        name= _ "Rundars Shadow"
        side=3
        canrecruit=yes
        recruit=Royal Warrior,Cavalier,Arch Mage
        team_name=wesnoth
        [ai]
            grouping=defensive
        [/ai]
        {GOLD 200 200 200}
        {INCOME 30 30 30}
        defeat_condition = never
		[village]
			x=8
			y=41
		[/village]
		[village]
			x=9
			y=42
		[/village]
		[village]
			x=10
			y=41
		[/village]
		[village]
			x=12
			y=41
		[/village]
		[village]
			x=11
			y=43
		[/village]
		[village]
			x=11
			y=44
		[/village]
		[village]
			x=7
			y=44
		[/village]
		[village]
			x=7
			y=45
		[/village]
		[village]
			x=10
			y=45
		[/village]
		[village]
			x=9
			y=46
		[/village]
		[village]
			x=12
			y=46
		[/village]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 12
            y = 43
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 12
            y = 40
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
    [/side]

    #protecting Generals 2
    [side]
        type=Grand Marshal
        id=Heford2
        name= _ "Adirsus Shadow"
        side=4
        canrecruit=yes
        recruit=Royal Guard,Paladin,Master at Arms,Master Bowman,Grand Marshal
        team_name=wesnoth
        {GOLD 200 200 200}
        {INCOME 24 24 24}
        defeat_condition = never

        #KI
        [ai]
            aggression =0.8
        [/ai]
		[village]
			x=14
			y=41
		[/village]
		[village]
			x=17
			y=42
		[/village]
		[village]
			x=19
			y=41
		[/village]
		[village]
			x=18
			y=41
		[/village]
		[village]
			x=15
			y=43
		[/village]
		[village]
			x=15
			y=44
		[/village]
		[village]
			x=19
			y=44
		[/village]
		[village]
			x=19
			y=43
		[/village]
		[village]
			x=16
			y=45
		[/village]
		[village]
			x=17
			y=46
		[/village]
		[village]
			x=14
			y=46
		[/village]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 14
            y = 43
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 14
            y = 40
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
    [/side]

    #Fal Khag
    [side]
        side = 5
        controller = null
        hidden = yes
    [/side]

    #Generals 3 osten
    [side]
        type=General
        id=Heford3
        name= _ "Heford3"
        side=6
        canrecruit=yes
        recruit=Lancer,Swordsman,Longbowman,Mage of Light
        team_name=wesnoth
        {GOLD 0 0 0}
        {INCOME 48 48 48}
        defeat_condition = never
        [unit]
            type = Master Bowman
            upkeep=free
            max_moves=1
            x = 23
            y = 22
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Master Bowman
            upkeep=free
            max_moves=1
            x = 21
            y = 21
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 11
            y = 23
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 6
            y = 19
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 18
            y = 32
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
		[village]
			x=22
			y=29
		[/village]
		[village]
			x=23
			y=32
		[/village]
		[village]
			x=19
			y=31
		[/village]
		[village]
			x=21
			y=35
		[/village]
		[village]
			x=17
			y=27
		[/village]
		[village]
			x=10
			y=33
		[/village]
		[village]
			x=10
			y=35
		[/village]
		[village]
			x=8
			y=33
		[/village]
		[village]
			x=4
			y=29
		[/village]
    [/side]

    #Generals 4 norden 
    [side]
        type=General
        id=Heford4
        name= _ "Heford4"
        side=7
        canrecruit=yes
        recruit=Pikeman,Javelineer,Longbowman,Mage
        team_name=wesnoth
        {GOLD 200 180 200}
        {INCOME 6 6 6}
        [ai]
            recruitment_pattern=Pikeman,Pikeman,Pikeman,Pikeman,Javelineer,Javelineer,Javelineer,Longbowman,Longbowman,Longbowman,Longbowman,Mage
            grouping=defensive
        [/ai]
        [unit]
            type = Master Bowman
            upkeep=free
            max_moves=1
            x = 13
            y = 10
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 6
            y = 16
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
        [unit]
            type = Arch Mage
            upkeep=free
            max_moves=1
            x = 4
            y = 14
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
        [/unit]
		[village]
			x=17
			y=10
		[/village]
		[village]
			x=7
			y=12
		[/village]
		[village]
			x=7
			y=15
		[/village]
		[village]
			x=14
			y=15
		[/village]
		[village]
			x=17
			y=17
		[/village]
    [/side]

    #Manherr
    [side]
        side = 8
        controller = ai
        defeat_condition = never
        hidden = yes

        #KI
        [ai]
            grouping=defensive
            passive_leader=yes
        [/ai]
    [/side]

    #Map Change
    [label]
        x,y=10,32
        text= _ "Rucity"
    [/label]
    [label]
        x,y=21,30
        text= _ "Woodsmagnate"
    [/label]

    #Objectives
    [event]
        name=prestart
        [set_variable]
            name=General1tod
            value=no
        [/set_variable]
        [set_variable]
            name=General2tod
            value=no
        [/set_variable]
        [objectives]
            side=1
            [objective]
                description= _ "Storm the Palace and capture the King by positioning an orcish unit next to him."
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Umaduro"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Tragtrad"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Manma"
                condition=lose
            [/objective]
            note = Note that the time works different in this scenario.
            note = After one day (24 houres) forces loyal to the King may arise.
            note = Proceed carfully many enemy can show up unexpectetly.
            {TURNS_RUN_OUT}
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]

        [/objectives]

        #What if not have TODO + Darken Volk
        [recall]
            id=Umaduro
        [/recall]
        [recall]
            id=Manma
        [/recall]
        [recall]
            id=Volk
        [/recall]

        [set_variable]
            name=recaller
            value=yes
        [/set_variable]

        [fire_event]
            name=RecallUNITS
        [/fire_event]        

        [set_variable]
            name=Riderkills
            value=0
        [/set_variable]

        #allow your units forced march
        [set_menu_item]
            id = Gewaltmarsch
            description = _"forced march!"
            image = "attacks/foot-bare.png"
            [default_hotkey]
                key = f
            [/default_hotkey]
            [command]
                [modify_unit]
                    [filter]
                        side = 1
                        x = $x1
                        y = $y1
                    [/filter]
                    hitpoints = "$($this_unit.hitpoints - 10)"
                    moves = "$($this_unit.moves + 5)"
                [/modify_unit]
            [/command]
        [/set_menu_item]
    [/event]

    #recall your units / your Startunits
    [event]
        name = RecallUNITS
        first_time_only = no
        [if]
            [variable]
                name=recaller
                equals=yes
            [/variable]
            [then]
                [role]
                    side=1
                    search_recall_list= only
                    type=Orcish Crossbowman,Orcish Slurbow,Orcish Slayer,Orcish Warrior,Orcish Warlord,Orcish Nightblade,Troll,Troll Warrior,Troll Rocklobber,Troll Hero,Great Troll,Goblin Pillager,Direwolf Rider,Goblin Knight
                    role= helpers
                    [auto_recall]
                    [/auto_recall]
                    [else]
                        [set_variable]
                            name=recaller
                            value=no
                        [/set_variable]
                    [/else]
                [/role]
                [modify_unit]
                    [filter]
                        side = 1
                        role = helpers
                    [/filter]
                    num_traits = 3
                    [modifications] #only 2 Traits
                        {TRAIT_LOYAL}
                    [/modifications]                    
                [/modify_unit]
                [fire_event]
                    name = RecallUNITS
                [/fire_event]
            [/then]
        [/if]
    [/event]

    #spawn Death's units
    [event]
        name = Second Orcs
        first_time_only = yes
        [unit]
            id=Death
            name= _ "Death"
            type=Orcish Nightblade
            unrenamable = yes
            canrecruit=no
            experience=44
            max_moves=8
            max_hitpoints = 70
            x=24
            y=2
            level = 4
            [attack]
                name=Slashing blunt knives
                description=_"throwing blunt knives"
                icon=attacks/dagger-thrown-poison-orcish.png
                type=impact
                range=melee
                damage=5
                number=5
                [specials]
                    [chance_to_hit]
                        id=traitReplace
                        name= _ ""
                        sub=20
                        apply_to=opponent
                    [/chance_to_hit]
                    {WEAPON_SPECIAL_POISON}
                [/specials]
            [/attack]
            
            [attack]
                name=throwing blunt knives
                description=_"throwing blunt knives"
                icon=attacks/dagger-thrown-poison-orcish.png
                type=impact
                range=ranged
                damage=5
                number=5
                [specials]
                    [chance_to_hit]
                        id=traitReplace
                        name= _ ""
                        sub=20
                        apply_to=opponent
                    [/chance_to_hit]
                    {WEAPON_SPECIAL_POISON}
                [/specials]
            [/attack]

            [modifications]
                [trait]
                id=agile
                male_name= _ "agile"
                help_text= _ "<italic>text='Agile'</italic> units have 30% higher Defense on any terrain." + _ "

Agile is the strongest trait, only very selcet units have this strength. Units with the agile trait often are nearly impossible to kill, which is be important to consider when deploying your forces."

                  
                [/trait]
                {TRAIT_QUICK}
                
            [/modifications]
            [abilities]
                {ABILITY_LEADERSHIP}
            [/abilities]
        [/unit]

        [unit]
            type = Orcish Slayer
            x,y=23,3
            max_attacks = 2
            [abilities]
                {ABILITY_REGENERATES}
            [/abilities]
        [/unit]
        [unit]
            type = Orcish Slayer
            x,y=25,3
            max_attacks = 2
            [abilities]
                {ABILITY_REGENERATES}
            [/abilities]
        [/unit]
        [unit]
            type = Orcish Slayer
            x,y=24,1
            max_attacks = 2
            [abilities]
                {ABILITY_REGENERATES}
            [/abilities]
        [/unit]
        [message]
            speaker=Death
            message= _ "Aye, I agreed to follow you Tragtrad, but this seems just suicidal?"        
        [/message]
    [/event]
#---------

    #Starting conversation
    [event]
        name=start
        [message]
            speaker=Tragtrad #Funny note that you should retry if you have to few or no other units TODO
            message= _ "Folks we have arrived, weldyn is a days march to the south."
        [/message]
        [message]
            speaker=Tragtrad 
            message= _ "We have no time to rest, that King has already assambeled a small army. We will push on immediately, leave no one that stands in ouur way alive"
        [/message]
        [message]
            speaker=King
            message= _ "ORCS! ORCS! ORCS! ORCS IN MY CAPITAL. Kill them, Kill them all, leave none of those beasts alive!"        
        [/message]
        [message]
            speaker=Heford
            message= _ "Yes my King those animals will suffer."        
        [/message]
        [message]
            speaker=Heford2
            message= _ "Help from Don Tark is set to arrive within a day, time is on our side."        
        [/message]
        [message]
            speaker=King
            message= _ "You useless bastards kill them NOW and don't let them near me!"        
        [/message]
        [message]
            speaker=Umaduro
            message= _ "What is your plan here?"        
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "We cannot wait we need to push onwards, I'll lead the charge!"
        [/message]

        [if]
            [variable]
                name=Orcbonus
                equals=yes
            [/variable]
            [then]
                [fire_event]
                    name = Second Orcs
                [/fire_event]
            [/then]
        [/if]
    [/event]

    #magical place
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side = 1
            x=11
            y=39
        [/filter]
        [message]
            speaker=unit
            message= _ "This Place seems magical!"
        [/message]
    [/event]
    
    #magical Place Darken volk + Queen
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side = 1
            id =Volk
            x=11
            y=39
        [/filter]
        [message]
            speaker=Volk 
            message= _ "There is some kind of dark power here! A magical seal, I will break it."
        [/message]
        [message]
            speaker=Volk 
            message= _ "I have searched for something like this for a long time!"
        [/message]
        [message]
            speaker=Volk 
            message= _ "Her power it, it is too strong!"
        [/message]
        [unit]
            id=Queen
            name= _ "The unspoken"
            unrenamable=yes
            type=Lich 
            side=8
            x,y=12,39
        [/unit]
        [message]
            speaker=Queen 
            message= _ "One Year ago my husband has sealed me in this hole, I will not let him get away with it now! Get out of my way! Letarg I am coming for you!"
        [/message]
        [message]
            speaker=Volk 
            message= _ "No, she is too strong for me!"
        [/message]
        [kill]
            side = 1
            id = Volk
        [/kill]
        [message]
            speaker=King  
            message= _ "Are you out of your mind?! You have let her out?!"
        [/message]
    [/event]

    #villages plundered
    [event]
        name = capture
        first_time_only = no
        [filter]
            side = 1
            race = orc, goblin
        [/filter]
        [message]
            speaker=unit
            message= _ "House cleared! Gold taken!"
        [/message]
        [gold]
            side=1
            amount=60
        [/gold]
        [terrain]
            x = $x1
            y = $y1
            terrain=Rb^Dr
        [/terrain]
        [item]
            x = $x1
            y = $y1
            image=scenery/village-human-burned2.png
        [/item]
        {GENERIC_UNIT 2 Peasant $x1 $y1}

    [/event]

    #spawn Riders TODO mehr animation
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            side =1
            x = 0,  1,  2,  3,  4,  5,  6,  7,  8,  9,  10, 11
            y =22-30,22-31,21-31,21-32,20-32,20-34,19-34,20-32,19-31,20-31,21-27,23-27
        [/filter]

        #Untere Riders
            [unit]
                type = Grand Knight
                id = Rider Leader
                x = 2
                y = 27
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [abilities]
                    {ABILITY_LEADERSHIP}
                [/abilities]
                role = turnRiders
            [/unit]
            [unit]
                type = Lancer
                x = 3
                y = 28
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Horseman
                x = 1
                y = 28
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Lancer
                x = 2
                y = 26
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
        #-----

        #Obere Riders
            [unit]
                type = Knight
                x = 1
                y = 24
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Knight
                x = 3
                y = 24
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Paladin
                x = 2
                y = 24
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Knight
                x = 2
                y = 25
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
        #------

        [message]
            speaker= Rider Leader
            message= _ "The riders of Elsefar have come to rescue the King."
        [/message]
        [message]
            speaker= King
            message= _ "I need not be recued, Elsenfars Riders are obliged to follow me."
        [/message]
    [/event]

    #Riders kill people
    [event]
        name=last breath
        first_time_only= no

        [filter]
            side = 1, 5 ,8
        [/filter]

        [filter_second]
            side=2
            role  = turnRiders
        [/filter_second]
        
        [set_variable]
           name=Riderkills
           add=1
        [/set_variable]
        [message]
            speaker= King
            message= _ "So you really managed to kill one of those beasts, hard to believe."
        [/message]
        [message]
            speaker= Rider Leader
            message= _ "..."
        [/message]
    [/event]

    #Woodsmagnate right village
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            side =1
            x = 19,20,21,22,23
            y =29-31,29-31,29-32,28-31,29-32
        [/filter]
        [unit]
            type = Longbowman
            x = 19
            y = 29
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = City Militia
            x = 19
            y = 31
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Spearman
            x = 23
            y = 31
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Rogue
            id = east talker
            x = 21
            y = 30
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker= east talker
            message= _ "The People of Woodsmagnate will always fight orcs!"
        [/message]
    [/event]
    
    #Rucity left village
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            side =1
            x = 7,8,9,10,11,12
            y =33-34,32-34,32-35,32-35,33-35,33-34
        [/filter]
        [unit]
            type = Highwayman
            x = 9
            y = 32
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = City Militia
            x = 10
            y = 33
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Spearman
            x = 12
            y = 34
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Outlaw
            id = west talker
            x = 7
            y = 34
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Rogue
            x = 10
            y = 34
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker= west talker
            message= _ "The People of Rucity will always fight orcs!"
        [/message]
    [/event]

    #every turn checker for Fal Khag, when both close Generals are dead | Also Riders
    [event]
        name = new turn
        first_time_only= no
        [if]
            [variable]
                name=General1tod
                equals=yes
            [/variable]
            [then]
                [if]
                    [variable]
                        name=General2tod
                        equals=yes
                    [/variable]
                    [then]
                        [fire_event]
                            name = new_orc
                        [/fire_event]
                    [/then]
                [/if]
            [/then]
        [/if]

        #-----
        [if]
            [variable]
                name=Riderkills
                greater_than_equal_to=3
            [/variable]
            [then]
                [fire_event]
                    name = Riders change
                [/fire_event]
            [/then]
        [/if]
    [/event]

    #Riders change
    [event]
        name = Riders change
        first_time_only = yes
        [message]
            speaker= Rider Leader
            message= _ "This so called King is not worth our blade and our deaths."
        [/message]
                
        [modify_unit]
            [filter]
            side=2
            role = turnRiders
            [/filter]
            side  = 8
        [/modify_unit]
    [/event]

    #Fal khag shows up
    [event]
        name = new_orc
        first_time_only = yes
        [scroll_to]
            x = 5
            y = 40
        [/scroll_to]

        [modify_side]
            side = 5
            id = Fal Khag
            controller=ai
            recruit = Orcish Warlord, Orcish Slurbow,Orcish Crossbowman,Orcish Warrior,Troll Hero
            team_name=dicks
            hidden = no
            village_support =2
            village_gold =3

            #Economy
            {GOLD 500 200 200}
            {INCOME 4 32 0}
        [/modify_side]

        [unit]
            side = 5
            canrecruit = yes
            type= Orcish Warlord
            id=Fal Khag
            name= _ "Fal Khag"
            health = 23
            experience = 134
            x = 1
            y = 39
            profile=portraits/orcs/grunt-2.png
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [message]
            speaker=Fal Khag
            message= _ "Wow folks, almost no resistance on the way here, seems like we are here."
        [/message]

        [message]
            speaker=King
            message= _ "More orcs? No, how! How deep has Wesnoth fallen as to roaming savages threating the rightful King!"
        [/message]

        [message]
            speaker=Tragtrad
            message= _ "Is that you Fal Khag?!"
        [/message]
        [message]
            speaker=Fal Khag
            message= _ "Tragtrad? Never thought I'd meet you here, still I won't mind killing you at all. Sorta unfinished buisness."
        [/message]

        [move_unit]
            side=5
            id = Fal Khag
            to_x = 4
            to_y = 36
        [/move_unit]

        
        [terrain]
            x =4
            y = 36
            terrain=Ke
        [/terrain]

        [terrain]
            x = 5,4,3,3,2
            y=  36, 35, 36 ,37,37
            terrain=Ce
        [/terrain]

        [unit]
            side = 5
            type= Orcish Slurbow
            x = 3
            y = 38
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [unit]
            side = 5
            type= Orcish Warlord
            x = 2
            y = 36
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [message]
            speaker=Fal Khag
            message= _ "Alright kill the orcisch princling and than the human princling."
        [/message]
    [/event]

    #Brücken sprengung
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            x = 1-27
            y= 44
            side = 1
        [/filter]

        [message]
            speaker = King 
            message = _ "They are so close, how? how? how? blow up the bridges, NOW!"
        [/message]
        [terrain]
            x=3
            y=50
            terrain=ww
        [/terrain]
        [terrain]
            x=8,23,25
            y=52,50,50
            terrain=Wo
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker = unit 
            message = _ "Seems like some of those explosions have failed boss. HE HE HE HE HE"
        [/message]

    [/event]

    #More Defenders show up
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            x = 1-27
            y= 36
            side = 1
        [/filter]
        
        #North spawn
            [unit]
                type = Halberdier
                id = hh1
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh2
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh3
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh4
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh5
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh6
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Master Bowman
                id = bb1
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Master Bowman
                id = bb2
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Master Bowman
                id = bb3
                max_moves=0
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type =Grand Marshal
                id = north_helper
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]
        #-----------

        [message]
            speaker = north_helper
            message = _ "Reinforcments from Gerradinans from Tath have arrived to rescue the King. His lordliness's doughter is would be with us to form a marriage pact."
        [/message]
        [message]
            speaker = King
            message = _ "This King needs not be rescued by the One Eyed Baron of Tath, this king is able to fight his own battles and will not marry woman, that are far beneath his statue only two generations from peasants."
        [/message]
        [message]
            speaker = north_helper
            message = _ "As you say milord, Soldiers Position."
        [/message]

        #Upper Upper
            [move_unit]
                side=2
                id = hh1
                to_x = 15
                to_y = 37
            [/move_unit]

            [move_unit]
                side=2
                id = hh2
                to_x = 17
                to_y = 37
            [/move_unit]

            [move_unit]
                side=2
                id = bb1
                to_x = 16
                to_y = 37
            [/move_unit]

            [terrain]
                x = 15-17
                y=  37
                terrain=Ce
            [/terrain]
        #-----

        #Upper Mid
            [move_unit]
                side=2
                id = hh3
                to_x = 19
                to_y = 38
            [/move_unit]
    
            [move_unit]
                side=2
                id = hh4
                to_x = 21
                to_y = 38
            [/move_unit]
    
            [move_unit]
                side=2
                id = bb2
                to_x = 20
                to_y = 38
            [/move_unit]
    
            [terrain]
                x = 19-21
                y=  38
                terrain=Ce
            [/terrain]
        #-----

        #Upper lower
            [move_unit]
                side=2
                id = hh5
                to_x = 15
                to_y = 39
            [/move_unit]
    
            [move_unit]
                side=2
                id = hh6
                to_x = 17
                to_y = 39
            [/move_unit]
    
            [move_unit]
                side=2
                id = bb3
                to_x = 16
                to_y = 39
            [/move_unit]
    
            [terrain]
                x = 15-17
                y=  39
                terrain=Ce
            [/terrain]
        #-----
    
            [move_unit]
                side=2
                id = north_helper
                to_x = 18
                to_y = 40
            [/move_unit]
            
        
        #Rechts spawn
            [unit]
                type = Halberdier
                id = hh1r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Halberdier
                id = hh2r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Halberdier
                id = hh3r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Halberdier
                id = hh4r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Halberdier
                id = hh5r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Halberdier
                id = hh6r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Master Bowman
                id = bb1r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Master Bowman
                id = bb2r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type = Master Bowman
                id = bb3r
                max_moves=0
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
            [/unit]

            [unit]
                type =Lieutenant
                id = Manherr
                x=21
                y=49
                side=2
                max_moves=0
                [modifications]
                    {TRAIT_INTELLIGENT}
                    {TRAIT_STRONG}
                [/modifications]
                role = ManherrForce
                canrecruit = yes
            [/unit]
        #--------------

        [message]
            speaker = Manherr
            message = _ "Reinforcments from Tarth from Tath have arrived to rescue the King. His royal' cousiness begs me to help the king"
        [/message]
        [message]
            speaker = King
            message = _ "I've always know my cousins barony to be among my most loyal subjects."
        [/message]
        [message]
            speaker = Manherr
            message = _ "As you say milord, Soldiers Position."
        [/message]
        [message]
            speaker = Umaduro
            message = _ "This traiterois Bastard, Tragtrad you should have killed him, not let him flee."
        [/message]
        [message]
            speaker = Tragtrad
            message = _ "Let us hope he is in fact a traitor."
        [/message]

        #Rechts Upper
            [move_unit]
                side=2
                id = hh1r
                to_x = 21
                to_y = 42
            [/move_unit]

            [move_unit]
                side=2
                id = hh2r
                to_x = 23
                to_y = 42
            [/move_unit]

            [move_unit]
                side=2
                id = bb1r
                to_x = 22
                to_y = 42
            [/move_unit]

            [terrain]
                x = 21-23
                y=  42
                terrain=Ce
            [/terrain]
        #-----

        #Rechts Mid
            [move_unit]
                side=2
                id = hh3r
                to_x = 23
                to_y = 44
            [/move_unit]
    
            [move_unit]
                side=2
                id = hh4r
                to_x = 25
                to_y = 44
            [/move_unit]
    
            [move_unit]
                side=2
                id = bb2r
                to_x = 24
                to_y = 44
            [/move_unit]
    
            [terrain]
                x = 23-25
                y=  44
                terrain=Ce
            [/terrain]
        #-----

        #Rechts lower
            [move_unit]
                side=2
                id = hh5r
                to_x = 20
                to_y = 45
            [/move_unit]
    
            [move_unit]
                side=2
                id = hh6r
                to_x = 22
                to_y = 45
            [/move_unit]
    
            [move_unit]
                side=2
                id = bb3r
                to_x = 21
                to_y = 46
            [/move_unit]
    
            [terrain]
                x = 20,21,22
                y=  45,46,45
                terrain=Ce
            [/terrain]
        #-----
    
            [move_unit]
                side=2
                id = Manherr
                to_x = 24
                to_y = 46
            [/move_unit]
        
        #Links spawn
            [unit]
                type = Halberdier
                id = hh1l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh2l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh3l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh4l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh5l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Halberdier
                id = hh6l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Master Bowman
                id = bb1l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Master Bowman
                id = bb2l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type = Master Bowman
                id = bb3l
                max_moves=0
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]

            [unit]
                type =Grand Marshal
                id = south_helper
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
            [/unit]
        #-----------

        [message]
            speaker = south_helper
            message = _ "Reinforcments from Gerradinans from Tath have arrived to rescue the King. His lordliness's doughter is would be with us to form a marriage pact."
        [/message]
        [message]
            speaker = King
            message = _ "This King needs not be rescued by the One Eyed Baron of Tath, this king is able to fight his own battles and will not marry woman, that are far beneath his statue only two generations from peasants."
        [/message]
        [message]
            speaker = south_helper
            message = _ "As you say milord, Soldiers Position."
        [/message]

        #Links Upper
            [move_unit]
                side=2
                id = hh1l
                to_x = 4
                to_y = 42
            [/move_unit]

            [move_unit]
                side=2
                id = hh2l
                to_x = 6
                to_y = 42
            [/move_unit]

            [move_unit]
                side=2
                id = bb1l
                to_x = 5
                to_y = 43
            [/move_unit]

            [terrain]
                x = 4,5,6
                y=  42,43,42
                terrain=Ce
            [/terrain]
        #-----

        #Links Mid
            [move_unit]
                side=2
                id = hh3l
                to_x = 1
                to_y = 44
            [/move_unit]
    
            [move_unit]
                side=2
                id = hh4l
                to_x = 3
                to_y = 44
            [/move_unit]
    
            [move_unit]
                side=2
                id = bb2l
                to_x = 2
                to_y = 44
            [/move_unit]
    
            [terrain]
                x = 1-3
                y=  44
                terrain=Ce
            [/terrain]
        #-----

        #Links lower
            [move_unit]
                side=2
                id = hh5l
                to_x = 4
                to_y = 46
            [/move_unit]
    
            [move_unit]
                side=2
                id = hh6l
                to_x = 6
                to_y = 46
            [/move_unit]
    
            [move_unit]
                side=2
                id = bb3l
                to_x = 5
                to_y = 47
            [/move_unit]
    
            [terrain]
                x = 4,5,6
                y=  46,47,46
                terrain=Ce
            [/terrain]
        #-----
    
            [move_unit]
                side=2
                id = south_helper
                to_x = 3
                to_y = 48
            [/move_unit]
            
        

    [/event]

    #Manherr turned (again)
    [event]
        name = attack
        first_time_only = yes
        [filter]
            side = 1
        [/filter]
        [filter_second]
            side = 2
            role = ManherrForce
        [/filter_second]
        [message]
            speaker=Manherr
            message= _ "Alright Now is the time!"
        [/message]
        [modify_unit]
            [filter]
            side = 2
            role = ManherrForce
            [/filter]
            side  = 8
            max_moves = 5
        [/modify_unit]
        
    [/event]

    #Let enemies show up in the end
#define BAD_CAVALRY TURN
    [event]
        name=turn {TURN}
        [if]
            [variable]
                name=turn_number
                numerical_equals=24
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    message= _ "Not even a full day had passed before the first advance elements of Wesnoth’s main army began to arrive..."
                    image="wesnoth-icon.png"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message= _ "Another advance element of the main Wesnoth army arrived..."
                    image="wesnoth-icon.png"
                [/message]
            [/else]
        [/if]

        {GENERIC_UNIT 2 (Duelist) 1 7}

        {GENERIC_UNIT 2 (Red Mage) 2 8}

        {GENERIC_UNIT 2 (Javelineer) 1 10}

        {GENERIC_UNIT 2 (Pikeman) 3 8}

        {GENERIC_UNIT 2 (Lieutenant) 2 5}

        {GENERIC_UNIT 2 (Longbowman) 1 11}

        {GENERIC_UNIT 2 (Duelist) 2 10}

        [gold]
            side=3
            amount=50
        [/gold]

        [gold]
            side=4
            amount=50
        [/gold]
    [/event]
#enddef

    {BAD_CAVALRY 24}
    {BAD_CAVALRY 28}
    {BAD_CAVALRY 32}
    {BAD_CAVALRY 36}
    {BAD_CAVALRY 40}
    {BAD_CAVALRY 44}
    {BAD_CAVALRY 48}
    {BAD_CAVALRY 52}
    {BAD_CAVALRY 56}

    #Todesnachrichten

    #left general dead
    [event]
        name=die
        [filter]
            id=Heford
        [/filter]
        [set_variable]
            name=General1tod
            value=yes
        [/set_variable]

        [message]
            speaker=King
            message= _ "What! No! How! How can these stupid beasts be winning against me?"
        [/message]
    [/event]

    #right general dead
    [event]
        name=die
        [filter]
            id=Heford2
        [/filter]
        [set_variable]
            name=General2tod
            value=yes
        [/set_variable]

        [message]
            speaker=King
            message= _ "MY GENERALS NO! How can they loose this war for me! Why am I sourrounded by Idiots? Everything is turning against me!"
        [/message]
    [/event]

    #Queen Death
    [event]
        name=last breath
        [filter]
            id=Queen
        [/filter]
        [message]
            speaker=Queen
            message= _ "Dream not I would go, I curse you! For 60 long years there shall not peace in my land of wesnoth!"
        [/message]
        [message]
            speaker=Heford3
            message= _ "My Queen NO!"
        [/message]
    [/event]

    #Death Death? 
    [event]
        name=last breath
        [filter]
            id=Death
        [/filter]
        [message]
            speaker=Death
            message= _ "No! how? I'm the master Assine, My school will stand until the end of time. I AM DEATH."
        [/message]
        [message]
            speaker=secondary_unit
            message= _ "Well now you have become DEATH! Hahaha"
        [/message]
    [/event]

    #Nord General
    [event]
        name=last breath
        [filter]
            id=Heford4
        [/filter]
        [message]
            speaker=Heford4
            message= _ "Noo! How could I have lost against those stupid bruts! I should have never betrayed Addirsu!"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "Alright, one done, keep going!"
        [/message]
    [/event]

    #Ost General
    [event]
        name=last breath
        [filter]
            id=Heford3
        [/filter]
        [message]
            speaker=Heford3
            message= _ "I die with honor for my true Queen!"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "Who's he talking about?"
        [/message]
    [/event]

    {Volk_DARK}

	#Defeats
    [event]
        name=last breath
        [filter]
            id=Umaduro
        [/filter]

        [message]
            speaker=Tragtrad
            message= _ "Noo! Without your advice there is no chance!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Manma
        [/filter]

        [message]
            speaker=Tragtrad
            message= _ "Nooo, we need the humans help!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Tragtrad
        [/filter]

        [message]
            speaker=Tragtrad
            message= _ "Well this is over..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    #real victory
    [event]
        name = moveto
        first_time_only =true
        [filter]
            x = 12, 13, 14      
            y= 48-49, 48-50,48-49
            side = 1
        [/filter]
        [message]
            speaker=King
            message= _ "No, No, No. Leave my alone. I am surrounded by Idiots, Fools Fools everywhere"
        [/message]
        [message]
            speaker=Tragtrad 
            message= _ "Alright shut this guy up for now!"
        [/message]
        [message]
            speaker=Tragtrad 
            message= _ "Manma your turn"
        [/message]
        [move_unit]
            side=1
            id = Manma
            to_x = 13
            to_y = 49
        [/move_unit]
        [message]
            speaker=Manma 
            message= _ "<Takes the crown>"
        [/message]
        #Spawn Rider to go to every barony that show up in the scenario
        [message]
            speaker=Manma 
            message= _ " My grandfather, the brother of Haldric III was the first baron of --- . The time has come to free Wesnoth from it's wrong former... . For the next five days will be a holiday of the free wesnoth Army!"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "It is time for a new age between the orcs and humans!"
        [/message]
        [message]
            speaker=Manma
            message= _ "That is correct."
        [/message]
        [message]
            speaker=Manma
            message= _ "Manherr lead my Army against these foreign invaders!"
        [/message]
        [message]
            speaker=Manherr
            message= _ "Alright Now is the time!"
        [/message]
        #TODO animate/story
        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 20}
        [/endlevel]
    [/event]
    
[/scenario]