[scenario]
    id = 05_Storming_the_Palace
    name = _"05 Storming the Palace"
    next_scenario = 06_Epilogue    
    map_file = 05_Storming_the_Palace.map
    turns = -1
    {NW_FULL_DAY}
    #random_start_time=no

    #Szenario Intro
    [story]
        [part]
            show_title=yes
            story = _ "Normally Tragtrad should be pleased, his plan seemed to be working, but Umaduro has avoided him ever since they crossed the great River and he has not said a word to him. His cousin was not alone, many of his orcish brothers did not seem onboard with his plan, and that despite him only taking his veterans with him. When he was back and no longer in enemy territory he would have to fear a challenge to his rule Tragtrad thought worried.
            
(1/2)" 
        [/part]
        [part]
            show_title=yes
            story = _ "Crossing many a field. At first the promise of the clans seemed to hold true, marching through the clans' land they were unperturbed, every village they found along the road was vacant. Until finally their luck turned, only a few leagues north of Weldyn, and the royal palace. 
            
(2/2)" 
        [/part]
        #[part]
        #    background=bigmap.png
        #[/part]
#----------
    [/story]

    #Sides #Give all L2+ units from recall list, also give all loyal trait, then only allow recalling
    #Tragtrad
    [side]
        type=Bloodthorn Orcish Leader
        id=Tragtrad
        side=1
        recruit=#Orcish Crossbowman,Orcish Warrior
        controller=human
        team_name=orcs
        user_team_name= _"Tragtrad's Bloodthorns"
        [filter_recall]
            id= hans peter
        [/filter_recall]
        {GOLD 0 0 0}
        {INCOME -2 -2 -2}
    [/side]

    #Wesnoth King
    [side]
        type=WOTG_King
        id=King
        name= _ "King Letarg"
        side=2
        canrecruit=yes
        team_name=Wesnoth
        recruit=
        {GOLD 300 0 300}
        {INCOME -2 -2 -2}
        [ai]
            passive_leader=yes
        [/ai]

        #villages
		    [village]
		    	x=3
		    	y=52
		    [/village]
		    [village]
		    	x=7
		    	y=51
		    [/village]
		    [village]
		    	x=10
		    	y=52
		    [/village]
		    [village]
		    	x=11
		    	y=51
		    [/village]
		    [village]
		    	x=13
		    	y=50
		    [/village]
		    [village]
		    	x=15
		    	y=51
		    [/village]
		    [village]
		    	x=16
		    	y=52
		    [/village]
		    [village]
		    	x=19
		    	y=51
		    [/village]
		    [village]
		    	x=23
		    	y=52
		    [/village]
        #----
    [/side]

    #General 1 Left Guard
    [side]
        type=Grand Marshal
        id=Heford
        name= _ "Rundars Shadow"
        side=3
        canrecruit=yes
        recruit=Royal Warrior,Cavalier,Arch Mage
        team_name=Wesnoth
        [ai]
            grouping=defensive
        [/ai]
        {GOLD 200 200 200}
        {INCOME 30 30 30}
        defeat_condition = never
        #villages
		    [village]
		    	x=8
		    	y=41
		    [/village]
		    [village]
		    	x=9
		    	y=42
		    [/village]
		    [village]
		    	x=10
		    	y=41
		    [/village]
		    [village]
		    	x=12
		    	y=41
		    [/village]
		    [village]
		    	x=11
		    	y=43
		    [/village]
		    [village]
		    	x=11
		    	y=44
		    [/village]
		    [village]
		    	x=7
		    	y=44
		    [/village]
		    [village]
		    	x=7
		    	y=45
		    [/village]
		    [village]
		    	x=10
		    	y=45
		    [/village]
		    [village]
		    	x=9
		    	y=46
		    [/village]
		    [village]
		    	x=12
		    	y=46
		    [/village]
        #-----

        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 12
            y = 43
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status]
            role = armoured
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 12
            y = 40
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
            role = armoured
        [/unit]
    [/side]

    #General 2 Right Guard
    [side]
        type=Grand Marshal
        id=Heford2
        name= _ "Adirsus Shadow"
        side=4
        canrecruit=yes
        recruit=Royal Guard,Paladin,Master at Arms,Master Bowman,Grand Marshal
        team_name=Wesnoth
        {GOLD 200 200 200}
        {INCOME 24 24 24}
        defeat_condition = never

        #KI
        [ai]
            aggression =0.8
        [/ai]

        #villages
		    [village]
		    	x=14
		    	y=41
		    [/village]
		    [village]
		    	x=17
		    	y=42
		    [/village]
		    [village]
		    	x=19
		    	y=41
		    [/village]
		    [village]
		    	x=18
		    	y=41
		    [/village]
		    [village]
		    	x=15
		    	y=43
		    [/village]
		    [village]
		    	x=15
		    	y=44
		    [/village]
		    [village]
		    	x=19
		    	y=44
		    [/village]
		    [village]
		    	x=19
		    	y=43
		    [/village]
		    [village]
		    	x=16
		    	y=45
		    [/village]
		    [village]
		    	x=17
		    	y=46
		    [/village]
		    [village]
		    	x=14
		    	y=46
		    [/village]
        #-----

        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 14
            y = 43
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
            role = armoured
        [/unit]
        [unit]
            type = Halberdier
            upkeep=free
            max_moves=1
            x = 14
            y = 40
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            [status]
                guardian = yes 
            [/status] 
            role = armoured
        [/unit]
    [/side]

    #Fal Khag
    [side]
        side = 5
        controller = null
        hidden = yes
    [/side]

    #Generals 3 Osten
    [side]
        type=General
        id=Heford3
        name= _ "Levan"
        side=6
        canrecruit=yes
        recruit=Lancer,Swordsman,Longbowman,Mage of Light
        team_name=Wesnoth
        {GOLD 0 0 0}
        {INCOME 48 48 48}
        defeat_condition = never

        #startunits
            [unit]
                type = Master Bowman
                upkeep=free
                max_moves=1
                x = 23
                y = 22
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
            [unit]
                type = Master Bowman
                upkeep=free
                max_moves=1
                x = 21
                y = 21
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
            [unit]
                type = Halberdier
                upkeep=free
                max_moves=1
                x = 11
                y = 23
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
            [unit]
                type = Halberdier
                upkeep=free
                max_moves=1
                x = 6
                y = 19
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status]
                role = armoured
            [/unit]
            [unit]
                type = Halberdier
                upkeep=free
                max_moves=1
                x = 18
                y = 32
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
        #-----

        #villages
		    [village]
		    	x=22
		    	y=29
		    [/village]
		    [village]
		    	x=23
		    	y=32
		    [/village]
		    [village]
		    	x=19
		    	y=31
		    [/village]
		    [village]
		    	x=21
		    	y=35
		    [/village]
		    [village]
		    	x=17
		    	y=27
		    [/village]
		    [village]
		    	x=10
		    	y=33
		    [/village]
		    [village]
		    	x=10
		    	y=35
		    [/village]
		    [village]
		    	x=8
		    	y=33
		    [/village]
		    [village]
		    	x=4
		    	y=29
		    [/village]
        #-----
    [/side]

    #Generals 4 Norden 
    [side]
        type=General
        id=Heford4
        name= _ "Lyrin"
        side=7
        canrecruit=yes
        recruit=Pikeman,Javelineer,Longbowman,Mage
        team_name=Wesnoth
        {GOLD 200 180 200}
        {INCOME 6 6 6}
        [ai]
            recruitment_pattern=Pikeman,Pikeman,Pikeman,Pikeman,Javelineer,Javelineer,Javelineer,Longbowman,Longbowman,Longbowman,Longbowman,Mage
            grouping=defensive
        [/ai]

        #startunits
            [unit]
                type = Master Bowman
                upkeep=free
                max_moves=1
                x = 13
                y = 10
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
            [unit]
                type = Halberdier
                upkeep=free
                max_moves=1
                x = 6
                y = 16
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
            [unit]
                type = Arch Mage
                upkeep=free
                max_moves=1
                x = 4
                y = 14
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
            [/unit]
        #-----

        #villages
		    [village]
		    	x=17
		    	y=10
		    [/village]
		    [village]
		    	x=7
		    	y=12
		    [/village]
		    [village]
		    	x=7
		    	y=15
		    [/village]
		    [village]
		    	x=14
		    	y=15
		    [/village]
		    [village]
		    	x=17
		    	y=17
		    [/village]
        #----
    [/side]

    #Waitanende
    [side]
        side = 8
        controller = ai
        defeat_condition = never
        team_name=Waitanende
        hidden = yes

        #KI
        [ai]
            grouping=defensive
            passive_leader=yes
        [/ai]
    [/side]

    #Map Change
    [label]
        x,y=10,32
        text= _ "Rucity"
    [/label]
    [label]
        x,y=21,30
        text= _ "Woodsmagnate"
    [/label]

    {VOLK_IMMORTAL_AND_ATTACK}

    #Variables setter
    [event]
        name=prestart
        [set_variable]
            name=General1tod
            value=no
        [/set_variable]
        [set_variable]
            name=General2tod
            value=no
        [/set_variable]
        [set_variable]
            name=Kingpos
            value=leftmid
        [/set_variable]
        [set_variable]
            name=recaller
            value=yes
        [/set_variable]     
        [set_variable]
            name=Riderkills
            value=0
        [/set_variable]
        [set_variable]
            name=togglespeach
            value=no
        [/set_variable]
    [/event]

    #Objectives
    [event]
        name=prestart
        [disallow_recruit]
            side=1
            type=Troll Whelp, Orcish Archer,Orcish Grunt,Wolf Rider#,Bloodthorn Orc #needs blance
        [/disallow_recruit]
        [objectives]
            side=1
            [objective]
                description= _ "Storm the palace and capture the king by positioning an Orc/Goblin/Troll unit next to him."
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Tragtrad"
                condition=lose
            [/objective]
            [objective]
                description= _ "When he turns up - Death of Manma"
                condition=lose
            [/objective]
			[note]
				description= _ "Your units do not have any upkeep in this scenario."
			[/note]
			[note]
				description= _ "Note that the time/turns works different in this scenario."
			[/note]
			[note]
				description= _ "After one day (24 hours/turns) forces loyal to the King will arrive from the road to the north."
			[/note]
			[note]
				description= _ "Proceed carefully many enemies can show up unexpectedly."
			[/note]
			[note]
				description= _ "By right clicking or pressing 'f' you can force your units to march, which gives them their max movepoints in exchange for 8 hp. This can be done once per unit at every turn, as long as that unit has more than 8 hp."
			[/note]
			[note]
				description= _ "Some of the enemies' units wear heavy armor and can thus move only very slowly. You can see it, when they have an icon on the top right."
			[/note]
			[note]
                [show_if]
                    [variable]
                        name=Orcbonus
                        equals=yes
                    [/variable]
                [/show_if]
				description= _ "Death’s assassins have two attacks per turn"
			[/note]
			[note]
                [show_if]
                    [variable]
                        name=Orcbonus
                        equals=yes
                    [/variable]
                [/show_if]
				description= _ "In the scenario using leadership is key - Tragtrad can reach Level 4 - Death is Level 4 - A troll should have a leadership ability"
			[/note]
			[note]
                [show_if]
                    [variable]
                        name=Orcbonus
                        not_equals=yes
                    [/variable]
                [/show_if]
				description= _ "In the scenario using leadership is key - Tragtrad can reach Level 4 - A troll should have a leadership ability"
			[/note]
			[note]
				description= _ "There is no recalling/recruiting in this scenario"
			[/note]            
            {IS_LAST_SCENARIO}
        [/objectives]
        [recall]
            id=Umaduro
        [/recall]
        #armoured icon
        [unit_overlay]
            side =2,3,4,5,6,7,8
            role = armoured
            image="misc/armour-icon.png"
            object_id=armouredpicture
            duration=forever
        [/unit_overlay]
        #Remove Manma from recall list
        [store_unit]
            variable=ManmaUnit
            kill=yes
            [filter]
                id=Manma
            [/filter]
        [/store_unit]
        #Get your start units
        [fire_event]
            name=RecallUNITS
        [/fire_event]  
        #set status for forced march
        [modify_unit]
            [filter]
                side = 1
                role = helpers
            [/filter]
            [status]
                forcedToMarch=no
            [/status]
        [/modify_unit]
        #Get Death 
        [if]
            [variable]
                name=Orcbonus
                equals=yes
            [/variable]
            [then]
                [fire_event]
                    name = Second Orcs
                [/fire_event]
            [/then]
        [/if]
        #make your units have no upkeep
        [modify_unit]
            [filter]
                side = 1
            [/filter]
            [effect]
                apply_to=loyal
            [/effect]
        [/modify_unit]        
        #remove recall list
        [kill]
            side=1
            x,y=recall,recall
        [/kill]
        #recall dwarf
        [if]
            [have_unit]
                id = Tester
                search_recall_list = yes
            [/have_unit]
            [then]
                [recall]
                    id = Tester
                [/recall]
            [/then]
        [/if]
        #recall naga
        [if]
            [have_unit]
                id = Marast the lost
                search_recall_list = yes
            [/have_unit]
            [then]
                [recall]
                    id = Marast the lost
                [/recall]
            [/then]
        [/if]
    [/event]    

    #allow your units forced march - allow toggle speach
    [event]
        name=prestart
        [set_menu_item]
            id=togglespeach_button
            description= _ "click this button to toggle Tragtrads speech after 'forced march'"
            [command]
                [if]
                    [variable]
                        name=togglespeach
                        equals=no
                    [/variable]
                    [then]
                        [set_variable]
                            name=togglespeach
                            value=true
                        [/set_variable]
                    [/then]
                    [else]
                        [set_variable]
                            name=togglespeach
                            value= no
                        [/set_variable]
                    [/else]
                [/if]
            [/command]
        [/set_menu_item]
        [set_menu_item]
            id = Gewaltmarsch
            description = _"forced march!"
            image = "attacks/foot-bare.png"
            [show_if]
                [have_unit]
                    side = 1
                    x = $x1
                    y = $y1
                    formula = "self.hitpoints > 8"
                    [not]
                        status=forcedToMarch
                    [/not]
                [/have_unit]
            [/show_if]
            [default_hotkey]
                key = f
            [/default_hotkey]
            [command]
                [modify_unit]
                    [filter]
                        side = 1
                        x = $x1
                        y = $y1
                        formula = "self.hitpoints > 8"
                    [/filter]
                    hitpoints = "$($this_unit.hitpoints - 8)"
                    moves = "($this_unit.max_moves)"
                    [status]
                        forcedToMarch=yes
                    [/status]
                [/modify_unit]
                [if]
                    [variable]
                        name=this_unit
                        not_equals=Tragtrad
                    [/variable]
                    [then]
                        [if]
                            [variable]
                                name=togglespeach
                                equals=no
                            [/variable]
                            [then]
                                [message]
                                    speaker=Tragtrad
                                    message= _ "You there! Don't stop, damn it!"
                                [/message]
                            [/then]
                        [/if]
                    [/then]
                [/if]
            [/command]
        [/set_menu_item]        
    [/event]
    
    #King moves along the walls / allow forced march every round
    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=Kingpos 
                equals=leftmid
            [/variable]
            [then]
                [move_unit]
                    id = King
                    to_x = 17
                    to_y = 51
                [/move_unit]
                [set_variable]
                    name=Kingpos
                    value=right
                [/set_variable]
                [fire_event]
                    name = Kingtalks
                [/fire_event]
            [/then]
            [elseif]
                [variable]
                    name=Kingpos 
                    equals=rightmid
                [/variable]
                [then]
                    [move_unit]
                        id = King
                        to_x = 9
                        to_y = 51
                    [/move_unit]
                    [set_variable]
                        name=Kingpos
                        value=left
                    [/set_variable]
                    [fire_event]
                        name = Kingtalks
                    [/fire_event]
                [/then]
            [/elseif]
            [elseif]
                [variable]
                    name=Kingpos 
                    equals=left
                [/variable]
                [then]
                    [move_unit]
                        id = King
                        to_x = 13
                        to_y = 49
                    [/move_unit]
                    [set_variable]
                        name=Kingpos
                        value=leftmid
                    [/set_variable]
                    [fire_event]
                        name = Kingtalks
                    [/fire_event]
                [/then]
            [/elseif]
            [elseif]
                [variable]
                    name=Kingpos 
                    equals=right
                [/variable]
                [then]
                    [move_unit]
                        id = King
                        to_x = 13
                        to_y = 49
                    [/move_unit]
                    [set_variable]
                        name=Kingpos
                        value=rightmid
                    [/set_variable]
                    [fire_event]
                        name = Kingtalks
                    [/fire_event]
                [/then]
            [/elseif]
            [else]
                [move_unit]
                    id = King
                    to_x = 13
                    to_y = 49
                [/move_unit]
                [set_variable]
                    name=Kingpos
                    value=leftmid
                [/set_variable]
                [fire_event]
                    name = Kingtalks
                [/fire_event]
            [/else]
        [/if]
        [modify_unit]
            [filter]
                side = 1
            [/filter]
            [status]
                forcedToMarch=no
            [/status]
        [/modify_unit]
    [/event]

    #King talks on the walls
    [event]
        name=Kingtalks
        first_time_only=no
        [set_variable]
            name=random
            rand=1..6
        [/set_variable]
        [switch]
            variable=random
            [case]
                value="1"
                [message]
                    speaker=King
                    message= _ "Orcs in my capital! What has Wesnoth come to."
                [/message]
            [/case]
            [case]
                value="2"
                [message]
                    speaker=King
                    message= _ "Useless bastards, all of you! Kill these beasts!"
                [/message]
            [/case]
            [case]
                value="3"
                [message]
                    speaker=King
                    message= _ "Whoever gives me the head of the big orc will be rewarded richly!"
                [/message]
            [/case]
            [case]
                value="4"
                [message]
                    speaker=King
                    message= _ "My barons are useless, all of them!"
                [/message]
            [/case]
            [case]
                value="5"
                [message]
                    speaker=King
                    message= _ "I AM THE KING I WILL NOT ALLOW ORCS IN WELDYN!"
                [/message]
            [/case]
            [case]
                value="6"
                [message]
                    speaker=King
                    message= _ "Please leave me alone!"
                [/message]
            [/case]
        [/switch]
        
    [/event]

    #recall your units / your Startunits
    [event]
        name = RecallUNITS
        first_time_only = no
        [if]
            [variable]
                name=recaller
                equals=yes
            [/variable]
            [then]
                [role]
                    side=1
                    search_recall_list= only
                    type=Orcish Crossbowman,Orcish Slurbow,Orcish Slayer,Orcish Warrior,Orcish Warlord,Orcish Nightblade,Troll,Troll Warrior,Troll Rocklobber,Troll Hero,Great Troll,Goblin Pillager,Direwolf Rider,Goblin Knight
                    role= helpers
                    [auto_recall]
                    [/auto_recall]
                    [else]
                        [set_variable]
                            name=recaller
                            value=no
                        [/set_variable]
                    [/else]
                [/role]
                [fire_event]
                    name = RecallUNITS
                [/fire_event]
            [/then]
        [/if]
    [/event]

    #Starting conversation
    [event]
        name=start
        [message]
            speaker=Tragtrad #Funny note that you should retry if you have too few or no other units TODO
            message= _ "Folks we have arrived; the royal palace is a day’s march to the south."
        [/message]
        [message]
            speaker=Tragtrad 
            message= _ "But we cannot rest now, that King has already assembled a small army. We will push on immediately, leave no one that stands in our way alive."
        [/message]
        
        {HIGHLIGHT_IMAGE 13 49 items/gohere.png ()}
        [message]
            speaker=King
            message= _ "ORCS! ORCS! ORCS! ORCS IN MY CAPITAL. Kill them, kill them all, leave none of those beasts alive!"        
        [/message]
        [message]
            speaker=Heford
            message= _ "Yes my king, those animals will suffer."        
        [/message]
        [message]
            speaker=Heford2
            image="portraits/humans/marshal-2.webp"~RIGHT()
            message= _ "The army is to return from Halstead within a day, time is on our side."        
        [/message]
        [message]
            speaker=King
            message= _ "You useless bastards kill them NOW and don't let them near me!"        
        [/message]
        [message]
            speaker=Umaduro
            message= _ "How exactly do you plan to win this, Tragtrad..."        
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "We just need to be quick, do not rest at all and we can ignore most of them. I will lead the charge myself!"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "When we are inside just decapitate that weakly human king, Manma will then rally them."
        [/message]
    [/event]

    #spawn Death's units
    [event]
        name = Second Orcs
        first_time_only = yes
        [unit]
            id=Death
            name= _ "Death"
            type=Orcish Death
            unrenamable = yes
            canrecruit=no
            experience=44
            x=24
            y=2
        [/unit]

        [unit]
            type = Orcish Slayer
            x,y=23,3
            max_attacks = 2
            [abilities]
                {ABILITY_REGENERATES}
            [/abilities]
        [/unit]
        [unit]
            type = Orcish Slayer
            x,y=25,3
            max_attacks = 2
            [abilities]
                {ABILITY_REGENERATES}
            [/abilities]
        [/unit]
        [unit]
            type = Orcish Slayer
            x,y=24,1
            max_attacks = 2
            [abilities]
                {ABILITY_REGENERATES}
            [/abilities]
        [/unit]
    [/event]

    #Death talks start not prestart
    [event]
        name = start
        [if]
            [variable]
                name=Orcbonus
                equals=yes
            [/variable]
            [then]
                [message]
                    speaker=Death
                    message= _ "Aye, I agreed to follow you Tragtrad, but this seems just suicidal?"        
                [/message]
            [/then]
        [/if]
    [/event]

    ##Volk is stronger closer to the source, if too close he is drawn to it TODO
    #[event]
    #    name=turn 3 end
    #    [message]
    #        speaker=Volk
    #        message= _ "I feel an extremely strong power here, like I have "
    #    [/message]
    #[/event]

    #magical place -- also after Queen awaken, maybe do something
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side = 1
            x=11
            y=39
            [not]
                id=vVolk
            [/not]
        [/filter]
        [message]
            speaker=unit
            message= _ "This Place seems ... I don't know ... magical."
        [/message]
        #[message]
        #    speaker=Volk 
        #    message= _ "I'll check it out!"
        #[/message]
        #[if]
        #    [variable]
        #        name=VolkAttacked
        #        equals=dead
        #    [/variable]
        #    [then]
        #        [unit]
        #            id=Volk
        #            name= _ "Volk"
        #            unrenamable=yes
        #            type=$Volk_respawns.type
        #            side=1
        #            x,y=10,37
        #            experience=$Volk_respawns.experience
        #            random_traits=no
        #        [/unit]
        #        [message]
        #            speaker=Volk
        #            message= _ "I cannot be killed!"
        #        [/message]
        #    [/then]
        #[/if]
    [/event]
    
    #magical Place Darken volk + Queen
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            side = 1
            id =Volk
            x=11
            y=39
        [/filter]
        [message]
            speaker=Volk 
            message= _ "There is some kind of dark power here! A magical seal, I will break it."
        [/message]
        [message]
            speaker=Volk 
            message= _ "I have searched for something like this for a long time!"
        [/message]
        [message]
            speaker=Volk 
            message= _ "The power it, it is too strong!"
        [/message]
        {THUNDER (
            [unit]
                id=Queen
                name= _ "The unspoken"
                unrenamable=yes
                type=Lich 
                side=8
                x,y=12,39   
                [modifications]
                    {TRAIT_FEARLESS}
                [/modifications]         
                [resistance]
                    blade = 40
                    pierce = 40
                    impact = 40
                    cold =40
                    fire =40
                    arcane=40
                [/resistance]
            [/unit]
        )}
        {FLASH_LIGHTNING (
            [message]
                speaker=Queen 
                message= _ "Two years ago my husband has sealed me in this hole, I will not let Wesnoth have peace! Get out of my way! Lyrin, Levan armies of Wesnoth I am coming for you!"
            [/message]
        )}
        [message]
            speaker=Volk 
            message= _ "No, no, no she is too strong for me!"
        [/message]
        [kill]
            side = 1
            id = Volk
        [/kill]
        [unit]
            id=fakemove
            name= _ ""
            unrenamable=yes
            type=Wisp
            side=8
            x,y=11,39
            random_traits=no
        [/unit]
        [move_unit]
            id=fakemove
            to_x=18
            to_y=18
        [/move_unit]
        [kill]
            id = fakemove
        [/kill]
        [unit]
            id=fakemove
            name= _ ""
            unrenamable=yes
            type=Greater Wisp
            side=8
            x,y=18,18
            random_traits=no
        [/unit]
        [move_unit]
            id=fakemove
            to_x=1
            to_y=7
        [/move_unit]
        [kill]
            id = fakemove
        [/kill]
        [message]
            speaker=King  
            message= _ "Are you out of your mind?! You have let her out?!"
        [/message]
    [/event]

    #first village plunder decison
    [event]
        name = capture
        first_time_only = yes
        [filter]
            side = 1
            race = orc, goblin, troll, wolf
        [/filter]
        [message]
            speaker=unit
            message= _ "Boss this hood is not empty as the ones before, shall we really not feast on the humans? (If you choose to plunder your orcs regain 16hp when destroying a village - you will however not keep your words to the humans)"#plunder food or eat humans?
            [option]
                label= _ "We should risk our lives, to save some human scum? Bugger that, my orcs will feast!"
                [command]
                    [set_variable]
                        name=humanfriendly
                        value=no
                    [/set_variable]
                    [message]
                        speaker=Umaduro 
                        message= _ "My orcs! Feast on the humans, replenish as you can!"
                    [/message]
                [/command]
            [/option]
            [option]
                label= _ "I will keep my word, even if given to a human."
                [command]
                    [message]
                        speaker=Umaduro 
                        message= _ "You are no longer my cousin, Tragtrad. You have no orcish soul, no fighting spirit, no orcish will!"
                    [/message]
                    [set_variable]
                        name=humanfriendly
                        value=yes
                    [/set_variable]
                [/command]
            [/option]
        [/message]
    [/event]

    #villages plundered - if chosen
    [event]
        name = capture
        first_time_only = no
        [filter]
            side = 1
            race = orc, goblin, troll, wolf
        [/filter]
        [if]
            [variable]
                name=humanfriendly
                equals=no
            [/variable]
            [then]
                [message]
                    speaker=unit
                    message= _ "All cleared! I am refreshed!"
                [/message]
                [modify_unit]
                [filter]
                    x = $x1
                    y = $y1
                [/filter]
                    hitpoints = "$($this_unit.hitpoints + 16)"
                [/modify_unit]
                [terrain]
                    x = $x1
                    y = $y1
                    terrain=Rb^Dr
                [/terrain]
                [item]
                    x = $x1
                    y = $y1
                    image=scenery/village-human-burned2.png
                [/item]
                {GENERIC_UNIT 2 Peasant $x1 $y1}
            [/then]
        [/if]
    [/event]

    #spawn Riders
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            side =1
            x = 0,  1,  2,  3,  4,  5,  6,  7,  8,  9,  10, 11
            y =22-30,22-31,21-31,21-32,20-32,20-34,19-34,20-32,19-31,20-31,21-27,23-27
        [/filter]

        [cancel_action]
        [/cancel_action]

        #Untere Riders
            [unit]
                type = Mounted General
                id = Rider Leader
                x = 2
                y = 27
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                [abilities]
                    {ABILITY_LEADERSHIP}
                [/abilities]
                role = turnRiders
            [/unit]
            [unit]
                type = Lancer
                x = 3
                y = 28
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Horseman
                x = 1
                y = 28
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Lancer
                x = 2
                y = 26
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
        #-----

        #Obere Riders
            [unit]
                type = Knight
                x = 1
                y = 24
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Horseman
                x = 3
                y = 24
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Paladin
                x = 2
                y = 24
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
            [unit]
                type = Knight
                x = 2
                y = 25
                side = 2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_RESILIENT}
                [/modifications]
                role = turnRiders
            [/unit]
        #------

        [message]
            speaker= Rider Leader
            image= "portraits/deoran.webp"
            message= _ "The new baroness of Waitanende wants to pay homage to the King and has sent gifts from the great barony of Waitanende."
        [/message]
        [message]
            speaker= King
            message= _ "So the old gobermouch baron is finally dead?"
        [/message]
        [message]
            speaker= Rider Leader
            image= "portraits/deoran-sad.webp"
            message= _ "Yes, sadly he died only two weeks ago after short illness, his oldest daughter has inherited, since no son has survived to adulthood. She wants to apologise for her father not coming to Halstead as ordered, it has taken her a while to get the estate in order, but now she wants to pay homage and has sent us ahead."
        [/message]
        [message]
            speaker= King
            message= _ "If the baroness wants to pay homage to me, you squash these orcs for and you shall be rewarded richly. Though I doubt men from Waitanende can kill anything, speaking of orcs."
        [/message]
        [message]
            speaker= Rider Leader
            image= "portraits/deoran-mad.webp"
            message= _ "We shall rescue the King, men!"
        [/message]
        [message]
            speaker= King
            message= _ "Not 'rescue'. I am the king; you have to follow my orders!"
        [/message]
        [message]
            speaker= Tragtrad
            message= _ "Rider, we want to replace this king with a better one, don't stand in my way, or I will have to cut you down!"
        [/message]
        [message]
            speaker= Rider Leader
            image= "portraits/deoran-sad.webp"
            message= _ "You want to replace the king of Wesnoth, orc? A queer task if I might say so. The men of Waitanende will fight for Wesnoth!"
        [/message]
    [/event]

    #Riders kill people
    [event]
        name=last breath
        first_time_only= no

        [filter]
            side = 1, 5 ,8
        [/filter]

        [filter_second]
            side=2
            role  = turnRiders
        [/filter_second]
        
        [set_variable]
           name=Riderkills
           add=1
        [/set_variable]
        [message]
            speaker= King
            message= _ "You really managed to kill one of those savages. Didn't expect that from someone from Waitanende it's, hard to believe."
        [/message]
        [message]
            speaker= second_unit
            message= _ "..."
        [/message]
    [/event]

    #Riders change
    [event]
        name = Riders change
        first_time_only = yes
        [message]
            speaker= turnRiders
            message= _ "This king does not respect the honor of the men of Waitanende, I will not be insulted by the offspring of some dark magician."
        [/message]
        [message]
            role=turnRiders
            message= _ "The baroness has made all of us swear an oath to always protect Wesnoth. That is what is worth to die for, not the upstart queen’s son!"
        [/message]
        [modify_unit]
            [filter]
            side=2
            role = turnRiders
            [/filter]
            side  = 8
        [/modify_unit]
                
        [if]
            [variable]
                name=humanfriendly
                equals=no
            [/variable]
            [then]
                [message]
                    role=turnRiders
                    message= _ "To protect Wesnoth is to rid Wesnoth of its dark magic king! Men slaughter whoever stands in our way!"
                [/message]
                [message]
                    speaker=Tragtrad
                    message= _ "I think they will fight each other, get out of their way and they'll basically help us."
                [/message]
                [message]
                    speaker= King
                    message= _ "You dare to raise your sword against your king! Your life is forfeit traitor!"
                [/message]
            [/then]
        [/if]

        [if]
            [variable]
                name=humanfriendly
                equals=true
            [/variable]
            [then]
                [message]
                    role=turnRiders
                    message= _ "Orc you have not butchered any villagers, I cannot believe I am saying this, but is it true you fought side by side with the great grandson of Haldric IV - is he with you?"
                [/message]
                [message]
                    speaker=Tragtrad
                    message= _ "It is true, my sword and that of Manma have drunken from the same blood, we fight the same foe for the same goal. He will be with us in the end."
                [/message]
                [message]
                    role=turnRiders
                    message= _ "Then I will fight for the descendants of the founder Haldric. That illegitimate son of darkness shall die by my own sword!"
                [/message]
                [modify_unit]
                    [filter]
                    side=2
                    role = turnRiders
                    [/filter]
                    side  = 1
                [/modify_unit]
                [message]
                    speaker= King
                    message= _ "You...You...You fight for the orcs? Against Wesnoth! Your life is forfeit traitor!"
                [/message]
            [/then]
        [/if]
    [/event]

    #Woodsmagnate right village
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            side =1
            x = 19,20,21,22,23
            y =29-31,29-31,29-32,28-31,29-32
        [/filter]
        
        [cancel_action]
        [/cancel_action]
        [unit]
            type = Longbowman
            x = 19
            y = 29
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Poacher
            x = 19
            y = 31
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Spearman
            x = 23
            y = 31
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Rogue
            id = east talker
            x = 21
            y = 30
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker= east talker
            message= _ "The people of Woodsmagnate will always fight orcs!"
        [/message]
    [/event]
    
    #Rucity left village
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            side =1
            x = 7,8,9,10,11,12
            y =33-34,32-34,32-35,32-35,33-35,33-34
        [/filter]
        
        [cancel_action]
        [/cancel_action]
        [unit]
            type = Highwayman
            x = 9
            y = 32
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Footpad
            x = 10
            y = 33
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Spearman
            x = 12
            y = 34
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Outlaw
            id = west talker
            x = 7
            y = 34
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type = Rogue
            x = 10
            y = 34
            side = 2
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker= west talker
            message= _ "The people of Rucity will always fight orcs!"
        [/message]
    [/event]

    #More Defenders show up - Manma
    [event]
        name=enter_hex
        first_time_only=true
        [filter]
            x = 1-27
            y= 36
            side = 1
        [/filter]        
        [cancel_action]
        [/cancel_action]

        #Upper
        
            #Upper spawn
                [unit]
                type = Halberdier
                id = hh1
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh2
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh3
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh4
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh5
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh6
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Master Bowman
                id = bb1
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Master Bowman
                id = bb2
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Master Bowman
                id = bb3
                max_moves=1
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type =Grand Marshal
                id = north_helper
                x=25
                y=39
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                [/unit]
            #-----------

            #Upper talk
                [message]
                    speaker = north_helper
                    message = _ "Reinforcements from the family of Garardinans from Tath have arrived to rescue the King. His lordliness's daughter is with us to form a marriage pact."
                [/message]
                [message]
                    speaker = King
                    message = _ "This king needs not be rescued by the One Eyed Baron of Tath, this king is able to fight his own battles and will not marry woman, that are far beneath his statue only two generations from peasants."
                [/message]
                [message]
                    speaker = north_helper
                    message = _ "As you say milord, Soldiers Position."
                [/message]
            #-----

            #Upper Upper
                [move_unit]
                side=2
                id = hh1
                to_x = 15
                to_y = 37
                [/move_unit]

                [move_unit]
                side=2
                id = hh2
                to_x = 17
                to_y = 37
                [/move_unit]

                [move_unit]
                side=2
                id = bb1
                to_x = 16
                to_y = 37
                [/move_unit]

                [terrain]
                x = 15-17
                y=  37
                terrain=Ce
                [/terrain]
            #-----

            #Upper Mid
                [move_unit]
                side=2
                id = hh3
                to_x = 19
                to_y = 38
                [/move_unit]
            
                [move_unit]
                side=2
                id = hh4
                to_x = 21
                to_y = 38
                [/move_unit]
            
                [move_unit]
                side=2
                id = bb2
                to_x = 20
                to_y = 38
                [/move_unit]
            
                [terrain]
                x = 19-21
                y=  38
                terrain=Ce
                [/terrain]
            #-----

            #Upper lower
                [move_unit]
                side=2
                id = hh5
                to_x = 15
                to_y = 39
                [/move_unit]
            
                [move_unit]
                side=2
                id = hh6
                to_x = 17
                to_y = 39
                [/move_unit]
            
                [move_unit]
                side=2
                id = bb3
                to_x = 16
                to_y = 39
                [/move_unit]
            
                [terrain]
                x = 15-17
                y=  39
                terrain=Ce
                [/terrain]
            #-----

            #move Upper leader
            [move_unit]
                side=2
                id = north_helper
                to_x = 18
                to_y = 40
            [/move_unit]   

        #-----         
        
        #Rechts Manherr

            #Rechts/Manherr spawn
                [unit]
                type = Halberdier
                id = hh1r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Halberdier
                id = hh2r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Halberdier
                id = hh3r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Halberdier
                id = hh4r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Halberdier
                id = hh5r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Halberdier
                id = hh6r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Master Bowman
                id = bb1r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Master Bowman
                id = bb2r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type = Master Bowman
                id = bb3r
                max_moves=1
                x=25
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                role = ManherrForce
                [/unit]

                [unit]
                type =Lieutenant
                id = Manherr
                name= _"Manherr"
                x=21
                y=49
                side=2
                [modifications]
                    {TRAIT_LOYAL_HERO}
                    {TRAIT_INTELLIGENT}
                    {TRAIT_STRONG}
                [/modifications]
                role = ManherrForce
                [/unit]            
   
                [unit]
                id=Manma
                name= _ "Manma"
                unrenamable=yes
                type=$ManmaUnit.type
                side=2
                x,y=20,48
                experience=$ManmaUnit.experience
                random_traits=no
                role = ManherrForce
                [modifications]
                    {TRAIT_LOYAL_HERO}
                [/modifications]
                [/unit]
            #--------------

            #Rechts talk
                [message]
                    speaker = Manherr
                    message = _ "The barons of Parthyn have come to protect Wesnoth and rid if of all its evil! His royal cousins begs me to help the king."
                [/message]
                [message]
                    speaker = King
                    message = _ "I've always known my cousin’s barony to be among my most loyal."
                [/message]
                [message]
                    speaker = Manherr
                    message = _ "As you say milord, Soldiers Position."
                [/message]
                [message]
                    speaker = Umaduro
                    message = _ "This traitorous bastard, Tragtrad you should have killed him, not let him flee."
                [/message]
                [message]
                    speaker = Tragtrad
                    message = _ "Let us hope he is in fact a traitor."
                [/message]
            #-----

            #Rechts Upper
                [move_unit]
                side=2
                id = hh1r
                to_x = 21
                to_y = 42
                [/move_unit]

                [move_unit]
                side=2
                id = hh2r
                to_x = 23
                to_y = 42
                [/move_unit]

                [move_unit]
                side=2
                id = bb1r
                to_x = 22
                to_y = 42
                [/move_unit]

                [terrain]
                x = 21-23
                y=  42
                terrain=Ce
                [/terrain]
            #-----

            #Rechts Mid
                [move_unit]
                side=2
                id = hh3r
                to_x = 23
                to_y = 44
                [/move_unit]
    
                [move_unit]
                side=2
                id = hh4r
                to_x = 25
                to_y = 44
                [/move_unit]
    
                [move_unit]
                side=2
                id = bb2r
                to_x = 24
                to_y = 44
                [/move_unit]
    
                [terrain]
                x = 23-25
                y=  44
                terrain=Ce
                [/terrain]
            #-----

            #Rechts lower
                [move_unit]
                side=2
                id = hh5r
                to_x = 20
                to_y = 45
                [/move_unit]
            
                [move_unit]
                side=2
                id = hh6r
                to_x = 22
                to_y = 45
                [/move_unit]
            
                [move_unit]
                side=2
                id = bb3r
                to_x = 21
                to_y = 46
                [/move_unit]
            
                [terrain]
                x = 20,21,22
                y=  45,46,45
                terrain=Ce
                [/terrain]
            #-----

            #move rechts leader(Manherr)
            [move_unit]
                side=2
                id = Manherr
                to_x = 24
                to_y = 47
            [/move_unit]
            [move_unit]
                side=2
                id = Manma
                to_x = 23
                to_y = 48
            [/move_unit]

        #------

        #Links
        
            #Links spawn
                [unit]
                type = Halberdier
                id = hh1l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh2l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh3l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh4l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh5l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Halberdier
                id = hh6l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Master Bowman
                id = bb1l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Master Bowman
                id = bb2l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type = Master Bowman
                id = bb3l
                max_moves=1
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [status]
                    guardian = yes 
                [/status] 
                role = armoured
                [/unit]

                [unit]
                type =Grand Marshal
                id = south_helper
                x=1
                y=47
                side=2
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_FEARLESS}
                [/modifications]
                [/unit]
            #-----------

            #Links talk
                [message]
                    speaker = south_helper
                    message = _ "Reinforcements from the Bay of Pearls have arrived to rescue the King. The barons are leading the main army here, to save the king."
                [/message]
                [message]
                    speaker = King
                    message = _ "I have not ordered that! Who dares to command my army? I gave the order to lay siege to Elensefar!"
                [/message]
                [message]
                    speaker = south_helper
                    message = _ "As you say milord, a rider will be sent to dispatch the orders, shall there be punishment for the ringleaders?"
                [/message]
                [message]
                    speaker = King
                    message = _ "Yes good point, I believe the responsible barons should fight the orcs here with their bare hands. But tell the army to come here and protect Weldyn!"
                [/message]
                [message]
                    speaker = south_helper
                    message = _ "As you say milord."
                [/message]
            #-----

            #Links Upper
                [move_unit]
                    side=2
                    id = hh1l
                    to_x = 4
                    to_y = 42
                [/move_unit]

                [move_unit]
                    side=2
                    id = hh2l
                    to_x = 6
                    to_y = 42
                [/move_unit]

                [move_unit]
                    side=2
                    id = bb1l
                    to_x = 5
                    to_y = 43
                [/move_unit]

                [terrain]
                    x = 4,5,6
                    y=  42,43,42
                    terrain=Ce
                [/terrain]
            #-----

            #Links Mid
                [move_unit]
                    side=2
                    id = hh3l
                    to_x = 1
                    to_y = 44
                [/move_unit]
            
                [move_unit]
                    side=2
                    id = hh4l
                    to_x = 3
                    to_y = 44
                [/move_unit]
            
                [move_unit]
                    side=2
                    id = bb2l
                    to_x = 2
                    to_y = 44
                [/move_unit]
            
                [terrain]
                    x = 1-3
                    y=  44
                    terrain=Ce
                [/terrain]
            #-----

            #Links lower
                [move_unit]
                    side=2
                    id = hh5l
                    to_x = 4
                    to_y = 46
                [/move_unit]
            
                [move_unit]
                    side=2
                    id = hh6l
                    to_x = 6
                    to_y = 46
                [/move_unit]
            
                [move_unit]
                    side=2
                    id = bb3l
                    to_x = 5
                    to_y = 47
                [/move_unit]
            
                [terrain]
                    x = 4,5,6
                    y=  46,47,46
                    terrain=Ce
                [/terrain]
            #-----
    
            #move links leader
            [move_unit]
                side=2
                id = south_helper
                to_x = 3
                to_y = 48
            [/move_unit]        
        
        #---------

        #armoured icon
        [unit_overlay]
            side =2,3,4,5,6,7,8
            role = armoured
            image="misc/armour-icon.png"
            object_id=armouredpicture
            duration=forever
        [/unit_overlay]
    [/event]

    #Manherr turns to your side, Manma shows up
    [event]
        name = turn refresh
        first_time_only = no
        [if]
            [have_unit]
                side=2
                id=Manherr
            [/have_unit]
            [then]
        [message]
            speaker=Manherr
            message= _ "Men of Wesnoth! The true king, great grandson of Haldric IV, my brother has returned to lead Wesnoth into a golden age! Bow to true King Manma!"
        [/message]
        [message]
            speaker=King
            message= _ "Another traitor? I am surrounded by traitors! What have I done to deserve this."
        [/message]
        [message]
            speaker=Manma
            message= _ "Letarg, you are the son of an undead magi and an ambitious commoner, every second you sit in the rightful place of the sons of Haldric as myself is a second Wesnoth suffers. This will end today! I promise!"
        [/message]
        {SAY (
            side=3,4,6,7 
            [not]
                id=king
            [/not]
        ) (_ "You are only another ambitious lord, don't pretend you are doing this for Wesnoth.")}
        [move_unit]
            id=Manherr
            to_x=17
            to_y=44
        [/move_unit]
        [message]
            speaker=Manherr
            message= _ "Die! Do not stand in the way of the true king!"
        [/message]
        [harm_unit]
            [filter]
                id=Heford2
            [/filter]
            [filter_second]
                id=Manherr
            [/filter_second]
            kill=no
            amount=53
            fire_event=yes
            animate=yes
        [/harm_unit]
        [message]
            speaker=Heford2
            image="portraits/humans/marshal-2.webp"~RIGHT()
            message= _ "You are a traitor to Wesnoth!"        
        [/message]
        [message]
            speaker=Manherr
            message= _ "I fight for Wesnoth!"
        [/message]
        [harm_unit]
            [filter]
                id=Manherr
            [/filter]
            [filter_second]
                id=Heford2
            [/filter_second]
            amount=50
            fire_event=yes
            animate=yes
        [/harm_unit]
        [kill]
            id=Manherr
        [/kill]
        
            [/then]
        [/if]   
        [modify_unit]
            [filter]
            side = 2
            role = ManherrForce
            [/filter]
            side  = 1
        [/modify_unit]  
    [/event]

    #every turn checker for Fal Khag, when one close Generals are dead | Also Riders
    [event]
        name = side 2 turn
        first_time_only= no
        [if]
            [variable]
                name=General1tod
                equals=yes
            [/variable]
            [then]
                [fire_event]
                    name = new_orc
                [/fire_event]
            [/then]
        [/if]
        [if]
            [variable]
                name=General2tod
                equals=yes
            [/variable]
            [then]
                [fire_event]
                    name = new_orc
                [/fire_event]
            [/then]
        [/if]

        #-----
        [if]
            [variable]
                name=Riderkills
                greater_than_equal_to=2
            [/variable]
            [then]
                [fire_event]
                    name = Riders change
                [/fire_event]
            [/then]
        [/if]
    [/event]

    #Fal khag shows up
    [event]
        name = new_orc
        first_time_only = yes
        [scroll_to]
            x = 5
            y = 40
        [/scroll_to]

        [modify_side]
            side = 5
            id = Fal Khag
            controller=ai
            recruit = Orcish Warlord, Orcish Slurbow,Orcish Crossbowman,Orcish Warrior,Troll Hero
            team_name=dicks
            hidden = no
            village_support =2
            village_gold =3

            #Economy
            {GOLD 500 200 200}
            {INCOME 4 32 0}

            #KI
            [ai]
                passive_leader=yes
            [/ai]
        [/modify_side]

        [unit]
            side = 5
            canrecruit = yes
            type= Orcish Warlord
            id=Fal Khag
            name= _ "Fal Khag"
            health = 23
            experience = 134
            x = 1
            y = 39
            profile=portraits/orcs/grunt-2.png
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [message]
            speaker=Fal Khag
            message= _ "Wow folks, almost no resistance on the way here, seems like we are here."
        [/message]

        [message]
            speaker=King
            message= _ "More orcs? No, how! How deep has Wesnoth fallen as to roaming savages threating the rightful king!"
        [/message]

        [message]
            speaker=Tragtrad
            message= _ "Is that you Fal Khag?!"
        [/message]
        [message]
            speaker=Fal Khag
            message= _ "Tragtrad? Never thought I'd meet you here, still I won't mind killing you at all. Sorta unfinished business."
        [/message]

        [move_unit]
            side=5
            id = Fal Khag
            to_x = 4
            to_y = 36
        [/move_unit]

        
        [terrain]
            x =4
            y = 36
            terrain=Ke
        [/terrain]

        [terrain]
            x = 5,4,3,3,2
            y=  36, 35, 36 ,37,37
            terrain=Ce
        [/terrain]

        [unit]
            side = 5
            type= Orcish Slurbow
            x = 3
            y = 38
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [unit]
            side = 5
            type= Orcish Warlord
            x = 2
            y = 36
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [message]
            speaker=Fal Khag
            message= _ "Alright kill the orcish princeling and then the human princeling."
        [/message]

        [if]
            [have_unit]
                id = Umaduro 
            [/have_unit]
            [then]
                [if]
                    [variable]
                        name=humanfriendly
                        equals=ture
                    [/variable]
                    [then]
                        [message]
                            speaker=Umaduro
                            message= _ "..."
                        [/message]
                        [message]
                            speaker=Umaduro
                            message= _ "Tragtrad, I ..."
                        [/message]
                        [move_unit]
                            side=1
                            id = Umaduro
                            to_x = 2
                            to_y = 36
                        [/move_unit]
                        [message]
                            speaker=Umaduro
                            message= _ "Fal Khag, you rightfully sit the bloodthorn throne, I will follow you"
                        [/message]
                        [modify_unit]
                            [filter]
                                id=Umaduro
                            [/filter]
                            side=5
                        [/modify_unit]

                        [message]
                            speaker=Fal Khag
                            message= _ "Ha! You see Tragtrad, even you closest cousin abandons you!"
                        [/message]
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]

    #Brücken sprengung
    [event]
        name = enter_hex
        first_time_only =true
        [filter]
            x = 1-27
            y= 44
            side = 1
        [/filter]
        
        [cancel_action]
        [/cancel_action]

        [message]
            speaker = King 
            message = _ "They are so close, how? how? how? blow up the bridges, NOW!"
        [/message]
        [terrain]
            x=3
            y=50
            terrain=ww
        [/terrain]
        [terrain]
            x=8,23,25
            y=52,50,50
            terrain=Wo
        [/terrain]
        [redraw]
        [/redraw]

        [message]
            speaker = unit 
            message = _ "Seems like some of those explosions have failed, boss. HE HE HE HE HE"
        [/message]

    [/event]
    
    #Manma cannot go to king
    [event]
        name = enter_hex
        first_time_only =no
        [cancel_action]
        [/cancel_action]
        [filter]
            x =18,8
            y= 52,52
            id=Manma
        [/filter]
        [move_unit]
            id = Manma
            to_x = 19
            to_y = 52
        [/move_unit]
        [message]
            speaker = Tragtrad
            message = _ "For the power of the new era, an orc has to defeat the king."
        [/message]
    [/event]

    #Let enemies show up in the end regularly
#define WESNOTH_ARMY TURN
    [event]
        name=turn {TURN}
        [if]
            [variable]
                name=turn_number
                numerical_equals=24
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    message= _ "Not even a full day had passed before the first advance elements of Wesnoth’s main army began to arrive..."
                    image="Wesnoth-icon.png"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message= _ "Another advance element of the main Wesnoth army arrived..."
                    image="Wesnoth-icon.png"
                [/message]
            [/else]
        [/if]
        {GENERIC_UNIT 2 (Duelist) 1 8}
        {GENERIC_UNIT 2 (Red Mage) 2 8}
        {GENERIC_UNIT 2 (Javelineer) 1 10}
        {GENERIC_UNIT 2 (Pikeman) 3 8}
        {GENERIC_UNIT 2 (Lieutenant) 2 9}
        {GENERIC_UNIT 2 (Longbowman) 1 11}
        {GENERIC_UNIT 2 (Duelist) 2 10}
        [gold]
            side=3
            amount=50
        [/gold]
        [gold]
            side=4
            amount=50
        [/gold]
    [/event]
#enddef

    #units arrive
        {WESNOTH_ARMY 24}
        {WESNOTH_ARMY 28}
        {WESNOTH_ARMY 32}
        {WESNOTH_ARMY 36}
        {WESNOTH_ARMY 40}
        {WESNOTH_ARMY 44}
        {WESNOTH_ARMY 48}
        {WESNOTH_ARMY 52}
        {WESNOTH_ARMY 56}
        {WESNOTH_ARMY 60}
        {WESNOTH_ARMY 64}
        {WESNOTH_ARMY 68}
        {WESNOTH_ARMY 72}
        {WESNOTH_ARMY 76}
        {WESNOTH_ARMY 80}
        {WESNOTH_ARMY 84}
        {WESNOTH_ARMY 88}
    #-----

    #Todesnachrichten
    #left general dead
    [event]
        name=die
        [filter]
            id=Heford
        [/filter]
        [set_variable]
            name=General1tod
            value=yes
        [/set_variable]

        [message]
            speaker=King
            message= _ "What! No! How! How can these stupid beasts be winning against me?"
        [/message]
    [/event]

    #right general dead
    [event]
        name=die
        [filter]
            id=Heford2
        [/filter]
        [set_variable]
            name=General2tod
            value=yes
        [/set_variable]

        [message]
            speaker=King
            message= _ "MY GENERALS NO! How can they lose this war for me! Why am I surrounded by Idiots? Everything is turning against me!"
        [/message]
    [/event]

    #Queen Death
    [event]
        name=last breath
        [filter]
            id=Queen
        [/filter]
        [message]
            speaker=Queen
            message= _ "Dream not I would go, I curse you! For 60 long years there shall not peace in my land of Wesnoth!"
        [/message]
        [message]
            speaker=Heford3
            message= _ "My Queen NO!"
        [/message]
    [/event]

    #Death Death? 
    [event]
        name=last breath
        [filter]
            id=Death
        [/filter]
        [message]
            speaker=Death
            message="No! How? I am the Master Assassin, my school will last until the end of time. I AM DEATH."
        [/message]
        #[message]
        #    speaker=secondary_unit
        #    message= _ "Well now you have become DEATH! Hahaha"
        #[/message]
    [/event]

    #Nord General
    [event]
        name=last breath
        [filter]
            id=Heford4
        [/filter]
        [message]
            speaker=Heford4
            message= _ "Noo! How could I have lost against those stupid brutes! I should have never betrayed Adirsu!"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "Alright, one done, keep going!"
        [/message]
    [/event]

    #Ost General
    [event]
        name=last breath
        [filter]
            id=Heford3
        [/filter]
        [message]
            speaker=Heford3
            message= _ "I die with honor for my true Queen!"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "Who's he talking about?"
        [/message]
    [/event]

	{MARAST_DEATH}

	#Defeats
	#{UMADURO_DEFEAT_DEATH}
    #Defeat Manma died
    [event]
        name=last breath
        [filter]
            id=Manma
        [/filter]
        [message]
            speaker=Tragtrad
            message= _ "Alright, it's over."
        [/message]
        [message]
            speaker=narrator
            message= _ "Please don't forget to give feedback (good and bad)! The link is in the campaign overview."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event] 
	{TRAGTRAD_DEFEAT_DEATH}

	#Umaduro dies
    [event]
        name=last breath
        [filter]
            id=Umaduro
        [/filter]

        [message]
            speaker=Umaduro
            message= _ "Tragtrad, please. Don't betray your race..."
        [/message]
    [/event]

    #victory
    [event]
        name=enter_hex
        first_time_only=no
        [filter]
            side=1
            race=orc,troll,wolf
            [or]
                id = King
            [/or]
        [/filter]

        [if]
            [have_unit]
                side=1
                race=orc,troll,wolf
                [filter_adjacent] 
                    id = King
                [/filter_adjacent] 
            [/have_unit]
            [then]
                [message]
                    speaker=King
                    message= _ "No, No, No. Leave me alone. I am surrounded by idiots, fools, fools everywhere."
                [/message]
                [message]
                    speaker=Tragtrad 
                    message= _ "Alright shut this guy up now. Manma!"
                [/message]
                [move_unit]
                    side=1
                    id = Manma
                    to_x = 13
                    to_y = 50
                [/move_unit]
                [message]
                    speaker=Manma 
                    message= _ "(Takes the crown)"
                [/message]
                [move_unit_fake]
                    side=2
                    type=Cavalryman
                    x=24,16
                    y=52,50
                [/move_unit_fake]
                [unit]
                    type=Cavalryman
                    id=Messenger_Clans
                    name= _ "Messenger"
                    x=16
                    y=50
                    side=2
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_INTELLIGENT}
                    [/modifications]
                [/unit]
                [move_unit_fake]
                    side=2
                    type=Cavalryman
                    x=24,14
                    y=52,51
                [/move_unit_fake]
                [unit]
                    type=Cavalryman
                    id=Messenger_Waitanende
                    name= _ "Messenger"
                    x=14
                    y=51
                    side=2
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_INTELLIGENT}
                    [/modifications]
                [/unit]
                [move_unit_fake]
                    side=2
                    type=Cavalryman
                    x=24,12
                    y=52,51
                [/move_unit_fake]
                [unit]
                    type=Cavalryman
                    id=Messenger_Army
                    name= _ "Messenger"
                    x=12
                    y=51
                    side=2
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_INTELLIGENT}
                    [/modifications]
                [/unit]
                [move_unit_fake]
                    side=2
                    type=Cavalryman
                    x=24,10
                    y=52,50
                [/move_unit_fake]
                [unit]
                    type=Cavalryman
                    id=Messenger_Elensefar
                    name= _ "Messenger"
                    x=10
                    y=50
                    side=2
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_INTELLIGENT}
                    [/modifications]
                [/unit]
                [message]
                    speaker=Manma 
                    message= _ "Guards, thow the usurper in the dungeons!"
                [/message]
                [move_unit]
                    id=King
                    to_x=13
                    to_y=52
                [/move_unit]
                [kill]
                    id =King
                [/kill]
                [move_unit]
                    side=1
                    id = Manma
                    to_x = 13
                    to_y = 49
                [/move_unit]
                [message]
                    speaker=Manma 
                    message= _ "The clans wait at the outskirts of Weldyn for news, tell them Wesnoth has a legitimate ruler once more. And tell them to ready themselves for what I told them beforehand!"
                [/message]
                [message]
                    speaker=Messenger_Clans
                    message= _ "Yes my king."
                [/message]
                [move_unit]
                    id=Messenger_Clans
                    to_x=25
                    to_y=3
                [/move_unit]
                [kill]
                    id=Messenger_Clans
                [/kill]
                [message]
                    speaker=Manma 
                    message= _ "The barons need to know of the new ruler, send north to Tarth, notify Dan'Tonk, ride to Waitande and tell the coast-barons. I want all barons in Wesnoth to come to Weldyn and pay homage."
                [/message]
                [message]
                    speaker=Messenger_Waitanende
                    message= _ "Yes my king."
                [/message]
                [move_unit]
                    id=Messenger_Waitanende
                    to_x=1
                    to_y=29
                [/move_unit]
                [kill]
                    id=Messenger_Waitanende
                [/kill]
                [message]
                    speaker=Manma
                    message= _ "The army is mobilised, it must have orders, otherwise it will turn to savagery, ride towards the army exchange the generals with trustworthy man of Parthyn in my name, they shall gather at the Ford of Abez, for my brother."
                [/message]
                [message]
                    speaker=Messenger_Army
                    message= _ "Yes my king."
                [/message]
                [move_unit]
                    id=Messenger_Army
                    to_x=1
                    to_y=7
                [/move_unit]
                [kill]
                    id=Messenger_Army
                [/kill]
                [message]
                    speaker=Manma
                    message= _ "Humans can not war amongst themselves. Send to Elensefar and tell the council there is need for a new treaty between Elensefar and Wesnoth."
                [/message]
                [message]
                    speaker=Messenger_Elensefar
                    message= _ "Yes my king."
                [/message]
                [move_unit]
                    id=Messenger_Elensefar
                    to_x=1
                    to_y=7
                [/move_unit]
                [kill]
                    id=Messenger_Elensefar
                [/kill]
                [message]
                    speaker=Manma 
                    message= _ "The blood of my great grandfather, Haldric IV now sits the Wesnoth throne again. The time has come to free Wesnoth from its insurrection of the commoner’s queen and her illegitimate offspring. For the next five days there will be a holiday for the free Wesnoth Army!"
                [/message]
                [message]
                    speaker=Tragtrad
                    message= _ "It is time for a new age between the orcs and humans!"
                [/message]
                [message]
                    speaker=Manma
                    message= _ "That is correct. A new age. One where we can sleep in peace."
                [/message]
                [message]
                    speaker=Manma
                    message= _ "Free Army of Wesnoth, march against these foreign invaders!"
                [/message]
                [message]
                    speaker=Tragtrad
                    message= _ "No, no, NO!"
                [/message]
                #TODO animate/story
                [endlevel]
                    result=victory
                    bonus=yes
                    {NEW_GOLD_CARRYOVER 20}
                [/endlevel]
            [/then]
        [/if]
    [/event]
    
[/scenario]