#textdomain wesnoth-An_Orcish_Might

#unused right now
#define VOLK_DARK
    [event]
        name=advance
        [filter]
            id = Volk
        [/filter]
        first_time_only = yes
        [message]
            speaker=Volk
            message= _ "Yes, yes, yeeeees! Finally, my power will grow forever!"
        [/message]
        [message]
            speaker=Manherr, Manma
            message= _ "My friend, what has gotten into you?"
        [/message]
    [/event]
#enddef

#define VOLK_IMMORTAL_AND_ATTACK
    [event]
        name = prestart
        #Recall Volk
        [if]
            [have_unit]
                id = Volk
                search_recall_list = yes
            [/have_unit]
            [then]
                [recall]
                    id = Volk
                [/recall]
            [/then]
            [elseif]
                [have_unit] #So the macro can be used in "Mages" as well
                    side=2
                    id = Orion
                [/have_unit]
                [then]
                [/then]
            [/elseif]
            [else]
                [unit]
                    id=Volk
                    name= _ "Volk"
                    unrenamable=yes
                    type=Shady Mage
                    side=1
                    x,y=1,1
                    experience=0
                    random_traits=no
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_RESILIENT}
                    [/modifications]
                [/unit]
                [put_to_recall_list]
                    id=Volk
                [/put_to_recall_list]
                [recall]
                    id=Volk
                [/recall]
            [/else]
        [/if]

        #Volk special attack
        [set_variable]
            name=VolkAttacked
            value=no
        [/set_variable]
        [set_menu_item]
            id = Volk_ability
            description = _"Volk will let loose a mighty attack!"
            image = "misc/volk_att.png"
            [show_if]
                [have_unit]
                    id=Volk
                [/have_unit]
                [have_unit]
                    x = $x1
                    y = $y1
                    [not]
                        id= Volk,King,Tragtrad,Umaduro,Floyd,Manma
                    [/not]
                    [filter_vision]
                        visible=yes
                        side=1
                        #[filter_side]
                        #
                        #[/filter_side]
                    [/filter_vision]
                    #[not]
                    #   side =1
                    #[/not]
                    
                [/have_unit]  
                [variable]
                    name=VolkAttacked
                    equals=no
                [/variable]
            [/show_if]
            [command]
                [message]
                    speaker=Volk
                    message= _ "Learn to fear me!"
                [/message]
                [harm_unit]
                    [filter]
                        x = $x1
                        y = $y1
                    [/filter]
                    [filter_second]
                        id = Volk
                    [/filter_second]
                    amount=15
                    fire_event=yes
                    animate=yes
                    experience=yes
                [/harm_unit]
                [set_variable]
                    name=VolkAttacked
                    value=yes
                [/set_variable]
            [/command]
        [/set_menu_item]
        
    [/event]
#enddef

#define UMADURO_DEFEAT_DEATH
	[event]
        name=last breath
        [filter]
            id=Umaduro
        [/filter]

        [message]
            speaker=Tragtrad
            message= _ "Noo! Without your advice there is no chance!"
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Please don't forget to give feedback (good and bad)! The link is in the campaign overview."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
#enddef

#define TRAGTRAD_DEFEAT_DEATH
	[event]
        name=last breath
        [filter]
            id=Tragtrad
        [/filter]

        [message]
            speaker=Tragtrad
            message= _ "Well this is over..."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Please don't forget to give feedback (good and bad)! The link is in the campaign overview."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
#enddef

#define SPECIAL_TROLL_DEATH
    [event]
        name= last breath
        [filter]
            role = elvisbearer
        [/filter]
        [message]
            speaker=unit
            message=_ "Elvis! Why? What have I done for you to abandon me? I... I... I have always done your bidding..."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message=_ "With the death of its bearer, the trolls no longer believe in the power of Elvis's stone."
        [/message]        
    [/event]
#enddef

#define MARAST_DEATH
	[event]
        name=last breath
        [filter]
            id=Marast the lost 
        [/filter]
        [message]
            speaker=Marast the lost 
            message= _ "I dizzz far from my home. Zzzzz."
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "The raza-king of the Serpent Samudra-Sea and kumara-Prince of Neez will be remembered."
        [/message]
        [message]
            speaker=Marast the lost 
            message= _ "I dizzz for a zzztrong leader. Goodzzz."
        [/message]
    [/event]
#enddef 

#define FLOYD_DEATH
	[event]
        name=last breath
        [filter]
            id=Floyd 
        [/filter]
        [message]
            speaker=Floyd 
            message= _ "..."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Aua."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Floyd is hurt."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Floyd wants home to his cave..."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Aua."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Why is Floyd so far from home?"
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Why... Elvis, can you hear me? Can I join you, Elvis? Elvis, I am sorry I only wanted to make you proud..."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Elvis are you proud?"
        [/message]
        [message]
            speaker=Tragtrad
            message= _ "Floyd, please! We were the ones who put the boulder in front of you cave! Come on! Keep going! You have to fight against the pain, Floyd. We will remove the boulder, I promise. You can go home, I promise! I promise..."
        [/message]
        [message]
            speaker=Floyd 
            message= _ "Tragtrad, you stay. I go. No following."
        [/message]
        [message]
            speaker=Tragtrad 
            message= _ "I... I'm sorry. Elvis is so proud of you!"
        [/message]
    [/event]
#enddef 

#define TRAGTRAD_RALLIED
        [if]
            [have_unit]
                side = 1
                type_adv_tree =Orcish Archer, Orcish Grunt, Wolf Rider 
                [not]
                    id = Umaduro, Tragtrad
                [/not]
            [/have_unit]
            [then]
                [modify_unit]
                    [filter]
                        side = 1
                        type_adv_tree =Orcish Archer, Orcish Grunt, Wolf Rider 
                        [not]
                            id = Umaduro, Tragtrad
                        [/not]
                    [/filter]
                    role = rallied
                [/modify_unit]
                [message]
                    role=rallied
                    message= _ "YES! FOR TRAGTRAD! FOR THE BLOODTHORNS!"
                [/message]                
            [/then]
        [/if]
#enddef

#define MAGIC_BOOK X Y
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side = 1
            x={X}
            y={Y}
        [/filter]
        [if]
            [variable]
                name=book_taken 
                equals=no
            [/variable]
            [then]
                [message]
                speaker=unit
                message= _ "There is a magic book here. What should I do with it? (The unit will gain a fire and arcane ranged attack and increased resistance to fire/arcane attacks.)"
                [option]
                    label= _ "We can only succeed by embracing the heretical methods of our enemies. Open it!"
                    [command]
                        [object]
                            id=fireBook
                            name= _ "Mages' Book"
                            image=items/book2.png 
                            duration=forever
                            description= _ "You open the book, its pages blank except for one. Two runes, stamped in a mixture of blood and molten gold, catch your eye. As you touch them, you feel a new power coursing through you."
                            cannot_use_message= _ "You are not worthy."
                            [filter]
                                x={X}
                                y={Y}
                                race=troll, orc, wolf
                            [/filter]
                            [then]
                                [remove_item]
                                    x,y= {X}, {Y}
                                [/remove_item]
                                {REMOVE_IMAGE 15 2}
                                [message]
                                    speaker=narrator
                                    message= _ "The book turned into dust in the hands of " + $unit.name +"."
                                [/message]
                                [set_variable]
                                    name=book_taken 
                                    value=true
                                [/set_variable]
                            [/then]
                            [effect]
                                apply_to=new_attack
                                name=sceptre of fire
                                description= _ "Fire ball"
                                icon=attacks/fireball.png
                                type=fire
                                range=ranged
                                [specials]
                                    {WEAPON_SPECIAL_MAGICAL}
                                [/specials]
                                damage=5
                                number=2
                            [/effect]
                            [effect]
                                apply_to=new_attack
                                name=shadow wave
                                description=_"shadow wave"
                                icon=attacks/dark-missile.png
                                type=arcane
                                range=ranged
                                [specials]
                                    {WEAPON_SPECIAL_MAGICAL}
                                [/specials]
                                damage=5
                                number=2
                            [/effect]
                            [effect]
                                apply_to=resistance
                                [resistance]
                                    blade=0
                                    pierce=0
                                    impact=0
                                    fire=-20
                                    cold=0
                                    arcane=-20
                                [/resistance]
                            [/effect]
                        [/object]
                    [/command]
                [/option]
                    [option]
                        label= _ "The mages devilism is nothing for us."
                    [/option]
                [/message]
            [/then]
        [/if]
    [/event]

#enddef

#define SAY FILTER MESSAGE
        [if]
            {FILTER}
            [then]
                [modify_unit]
                    [filter]
                        {FILTER}
                    [/filter]
                    role = talker
                [/modify_unit]
                [message]
                    role=talker
                    message= MESSAGE
                [/message]                
            [/then]
        [/if]
#enddef

#define TRAGTRAD_RALLIED
        [if]
            [have_unit]
                side = 1
                type_adv_tree =Orcish Archer, Orcish Grunt, Wolf Rider 
                [not]
                    id = Umaduro, Tragtrad
                [/not]
            [/have_unit]
            [then]
                [modify_unit]
                    [filter]
                        side = 1
                        type_adv_tree =Orcish Archer, Orcish Grunt, Wolf Rider 
                        [not]
                            id = Umaduro, Tragtrad
                        [/not]
                    [/filter]
                    role = rallied
                [/modify_unit]
                [message]
                    role=rallied
                    message= _ "YES! FOR TRAGTRAD! FOR THE BLOODTHORNS!"
                [/message]                
            [/then]
        [/if]
#enddef

#define SCROLL X Y
        [scroll_to]
            x=X
            y=Y
        [/scroll_to]
        [scroll_to_unit]
            id=Tragtrad
        [/scroll_to_unit]
#enddef

#elf interrogation



            #[message]
            #    speaker=Tragtrad
            #    message= _ "How should I handle this interrogation?"
            #    [option]
            #        label=_ "Talk."
            #        [command]
            #            [option]
            #                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                [command]
            #                    [option]
            #                        label=_ "If you show me an option to save my grunts, I can save you."
            #                        [command]
            #                            [option]
            #                                label=_ "."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ ""
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                    [option]
            #                        label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                [/command]
            #            [/option]
            #            [option]
            #                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                [command]
            #                    [option]
            #                        label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                    [option]
            #                        label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                [/command]
            #            [/option]
            #        [/command]
            #    [/option]
            #    [option]
            #        label= _ "Force."
            #        [command]
            #            [option]
            #                label=_ "Strike the elves face."
            #                [command]
            #                    [option]
            #                        label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                    [option]
            #                        label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                [/command]
            #            [/option]
            #            [option]
            #                label= _ "Break the elves leg."
            #                [command]
            #                    [option]
            #                        label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                    [option]
            #                        label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                        [command]
            #                            [option]
            #                                label=_ "We have the same goal elf, you don't want to die and I don't necessarly want to kill you."
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                            [option]
            #                                label= _ "I see you have 10 fingers, you don't need all of them, do you now?"
            #                                [command]
            #                                [/command]
            #                            [/option]
            #                        [/command]
            #                    [/option]
            #                [/command]
            #            [/option]
            #        [/command]
            #    [/option]
            #[/message]
#------------------------


#Messangers mod with king?
#plunder and raze mod?

#Taken from refolutions and civilwar mod author: Nyanyanyan
    #name=_"Revolution and Civil War"
    #description=_"It's treason, then! After a leader dies, a struggle for power will commence within their faction. All units, villages and gold of the faction will be split between the two sides and one unit on each side will be made into a new leader. The rebel leaders are able to recruit units as they would normally and upon the death of a rebelling leader, all their assets will be turned over to the victor. You can disable the return of assets when killing a rebel leader and enable the rebels as a playable faction in the options menu. Use the slider in Custom Options on map select to decide which side will be reserved for the rebels. Do not use Shuffle Sides unless you're playing on a custom map made for use with this mod."
	
    #TODO instead of number, flag if side is currently rebelling (3,4,6,7) side 13,14,16,17
    #TODO should rebels be able to recruit?
    #TODO what about the gold?
    #TODO allow more rebellions? one per general??
	#TODO what if loyal-rebels win (what is win?)
	#TODO when is very unwinnable rebel leader gives up
	#TODO only allow one revulution at any time
    #TODO unfriendly just make new leader
    #TODO ignore units that are armoured
    #TODO add side 10
    #TODO make the unit called out by the king as 'Gottfried I pronounce you new Commander of the northern forces!' vs 'Why are we fighting for this cruel .... king? I say we lay down our swords!'
    
    #needed for setup?
    [event]
        id=killsidesliderside
        name=turn 1
        first_time_only=no
        [set_variable]
            name=rebellionnumber
            value=1
        [/set_variable]
    [/event]
    
    #rebellion event
    [event]
        id=rebellion
        name=die
        first_time_only=no
        [filter_condition]
            [variable]
                name=rebellionnumber
                equals=0
            [/variable]
        [/filter_condition]
        #One of the generals dies
        [filter]
            canrecruit=yes
            side=3,4,6,7
            [and]
                [not]
                    [filter_wml]
                        [status]
                            warlord=yes
                        [/status]
                    [/filter_wml]
                [/not]
            [/and]
            [and]
                [not]
                    [filter_wml]
                        [status]
                            general=yes
                        [/status]
                    [/filter_wml]
                [/not]
            [/and]
            [and]
                [not]
                    ability=immortal
                    [or]
                        ability=immortal3
                    [/or]
                [/not]
            [/and]
        [/filter]
    
        [if]
            [not]
                [have_unit]
                    canrecruit=yes
                    side=$unit.side
                    [and]
                        [not]
                            id=$unit.id
                        [/not]
                    [/and]
                    [and]
                        [not]
                            [filter_wml]
                                [status]
                                    general=yes
                                [/status]
                            [/filter_wml]
                        [/not]
                    [/and]
                [/have_unit]
            [/not]
            [or]
                [have_unit]
                    canrecruit=yes
                    side=$unit.side
                    [and]
                        [not]
                            id=$unit.id
                        [/not]
                    [/and]
                    [and]
                        ability=immortal
                    [/and]
                [/have_unit]
                [and]
                    [not]
                        [have_unit]
                            canrecruit=yes
                            side=$unit.side
                            [and]
                                [not]
                                    ability=immortal
                                    [or]
                                    id=$unit.id
                                    [/or]
                                [/not]
                            [/and]
                            [and]
                                [not]
                                [filter_wml]
                                    [status]
                                        general=yes
                                    [/status]
                                [/filter_wml]
                                [/not]
                            [/and]
                        [/have_unit]
                    [/not]
                [/and]
            [/or]
            
            [then]
                #store the dead general in 'leaderdead'
                [store_unit]
                    [filter]
                        x,y=$x1,$y1
                        canrecruit=yes
                    [/filter]
                    variable=leaderdead
                [/store_unit] 
      
                #store all units(on the board) of dead general in leaderdeadwarlordcandidates
                [store_unit]
                    [filter]
                        side=$leaderdead.side
                        [and]
                            [not]
                                canrecruit=yes
                            [/not]
                        [/and]
                        [and]
                            [not]
                                x,y=recall,recall
                            [/not]
                        [/and]
                    [/filter]
                    variable=leaderdeadwarlordcandidates
                [/store_unit]
    
                [store_side]
                   side=$leaderdead.side
                   variable=rebellingside
                [/store_side]
       
                [set_variable]
                    name=alternatingvariable
                    value=0
                [/set_variable]
                [set_variable]
                    name=countingvariable
                    value=0
                [/set_variable]
    
                #make new loyal commander and rebel leader
                {FOREACH leaderdeadwarlordcandidates i}	
                [if]
                    #make the first of the saved units new general TODO add here Kings talk
                    [variable]  
                        name=countingvariable
                        equals="0"  
                    [/variable] 
                    [then]
                        [modify_unit]
                            [filter]
                                id=$leaderdeadwarlordcandidates[$i].id
                            [/filter]
                            canrecruit=yes
                        [/modify_unit]
                        [set_variable]
                            name=countingvariable
                            value=1
                        [/set_variable]
                    [/then]

                    #do nothing to the second unit - make sure it exists?
                    [elseif]
                        [variable]  
                        name=countingvariable
                        equals="1"  
                        [/variable]
                        [and]
                            [variable]  
                                name=leaderdeadwarlordcandidates[$i].upkeep
                                contains=loyal 
                            [/variable] 
                        [/and]
                        [then]
                        [/then]
                    [/elseif]
                    #make the second unit the rebellion leader #TODO make sure unit makes some sense and allow him to recruit the same things
                    [elseif]
                        [variable]  
                            name=countingvariable
                            equals="1"  
                        [/variable] 
                        [then]
                            [unit_overlay]
                                id=$leaderdeadwarlordcandidates[$i].id
                                image=misc/hero-icon.png
                            [/unit_overlay]
                            [store_unit]
                                [filter]
                                    id="$leaderdeadwarlordcandidates[$i].id"
                                [/filter]
                                variable=rebellionleader
                            [/store_unit]
                            [store_unit]
                                [filter]
                                    id=$leaderdeadwarlordcandidates[$i].id
                                [/filter]
                                variable=$leaderdeadwarlordcandidates[$i].id
                            [/store_unit]
                            [modify_unit]
                                [filter]
                                    id=$leaderdeadwarlordcandidates[$i].id
                                [/filter]
                                side=10
                                canrecruit=yes
                                [effect]
                                    apply_to=status
                                    add=warlord
                                [/effect]
                                #[variables]
                                #    rebelleaderbatch=$rebellionnumber
                                #[/variables]
                            [/modify_unit]
                            [allow_extra_recruit]
                                extra_recruit="$rebellingside.recruit"
                                id=$leaderdeadwarlordcandidates[$i].id
                            [/allow_extra_recruit]
                            [set_variable]
                                name=countingvariable
                                value=2
                            [/set_variable]
                        [/then]
                    [/elseif]
                    [else]
                        {CLEAR_VARIABLE leaderdeadwarlordcandidates}
                    [/else]
                [/if]
                {NEXT i}
                {CLEAR_VARIABLE alternatingvariable}
                {CLEAR_VARIABLE countingvariable}
                {CLEAR_VARIABLE leaderdeadwarlordcandidates}
            
                #store all units(on the board) of new general in leaderdeadsideunits
                [store_unit]
                    [filter]
                        side=$leaderdead.side
                        [and]
                            [not]
                            canrecruit=yes
                            [/not]
                        [/and]
                        [and]
                            [not]
                                x,y=recall, recall
                            [/not]
                        [/and]
                        [or]
                        side=$leaderdead.side
                        [and]
                            canrecruit=yes
                        [/and]
                        [and]
                            [filter_wml]
                                [status]
                                    general=yes
                                [/status]
                            [/filter_wml]
                        [/and]
                        [/or]
                    [/filter]
                    variable=leaderdeadsideunits
                [/store_unit]
    
                [set_variable]
                    name=alternatingvariable
                    value=1
                [/set_variable]
                [set_variable]
                    name=newrebelleader
                    value="$rebellionleader.id"
                [/set_variable]

                #give every second unit to the rebel
                {FOREACH leaderdeadsideunits i}	
                [if]
                    [variable]  
                        name=alternatingvariable
                        equals="0"  
                    [/variable] 
                
                    
                    [then]
                        [if]
                            [not]
                                [variable]  
                                    name=leaderdeadsideunits[$i].upkeep
                                    contains=loyal 
                                [/variable] 
                            [/not]
                            [then]
                                [modify_unit]
                                    [filter]
                                        id=$leaderdeadsideunits[$i].id
                                    [/filter]
                                    side=10
                                    [variables]
                                    rebelleaderid=$newrebelleader
                                    [/variables]
                                [/modify_unit]
                                [set_variable]
                                    name=alternatingvariable
                                    value=1
                                [/set_variable]
                            [/then]
                        [/if]
                    [/then]
                
                    [else]
                        [set_variable]
                            name=alternatingvariable
                            value=0
                        [/set_variable]
                    [/else]
                
                [/if]
                {NEXT i}
                
                [store_villages]
                    owner_side=$leaderdead.side
                    variable=leaderdeadsidevillages
                [/store_villages]
            
                [set_variable]
                    name=alternatingvariable2
                    value=1
                [/set_variable]
            
                #give every second village to the rebels? TODO maybe only those that are on villages a that moment?
                {FOREACH leaderdeadsidevillages i}	 
                [if]
                    [variable]  
                        name=alternatingvariable2
                        equals="0"  
                    [/variable] 
                
                    [then]
                        [capture_village]
                            x=$leaderdeadsidevillages[$i].x
                            y=$leaderdeadsidevillages[$i].y
                            side=10
                        [/capture_village]
                    
                        [capture_village]
                            x=$leaderdeadsidevillages[$i].x
                            y=$leaderdeadsidevillages[$i].y
                            [filter]
                            side=$leaderdead.side
                            [/filter]
                            side=$leaderdead.side
                        [/capture_village]
                    
                    
                    
                    
                    
                        [set_variables]
                            name=rebelleadervillages
                            mode=append
                            [value]
                            leader=$newrebelleader
                            x=$leaderdeadsidevillages[$i].x
                            y=$leaderdeadsidevillages[$i].y
                            batch=$rebellionnumber
                            [/value]
                        [/set_variables]
                    
                    
                    
                    
                        [set_variable]
                            name=alternatingvariable2
                            value=1
                        [/set_variable]
                    
                    
                    [/then]
                
                    [else]
                        [set_variable]
                            name=alternatingvariable2
                            value=0
                        [/set_variable]
                        [capture_village]
                            x=$leaderdeadsidevillages[$i].x
                            y=$leaderdeadsidevillages[$i].y
                            [filter]
                            side=10
                            [/filter]
                            side=10
                        [/capture_village]
                    [/else]
                [/if]
                {NEXT i}
        
                {CLEAR_VARIABLE leaderdeadsidevillages}
                {CLEAR_VARIABLE alternatingvariable}
                {CLEAR_VARIABLE capturedvillages}
                {CLEAR_VARIABLE leaderdeadsideunits}
                {CLEAR_VARIABLE rebellionleader}
                {CLEAR_VARIABLE newrebelleader}
                {CLEAR_VARIABLE alternatingvariable2}

                # How much gold each side gets
                #   [store_side]
                #       side=$leaderdead.side
                #       variable=loyalistside
                #   [/store_side]
                #   [modify_side]
                #       side=$leaderdead.side
                #       gold="$($loyalistside.gold /2)"
                #   [/modify_side]
               
                #   [store_side]
                #       side=10
                #       variable=rebelside
                #   [/store_side]
                #   [modify_side]
                #       side=10
                #       gold="$($rebelside.gold + $loyalistside.gold /2)"
                #   [/modify_side]
            [/then]
        [/if]
        
        {CLEAR_VARIABLE loyalistside}
        {CLEAR_VARIABLE rebelside}
        {CLEAR_VARIABLE leaderdead}
        [set_variable]
            name=rebellionnumber
            add=1
        [/set_variable]
    [/event]
    
    #the recruited units of the rebels are given side... unnecessary??
    [event]
        id=rebelrecruit
        name=recruit
        first_time_only=no
        [filter]
            side=10
        [/filter]
        [modify_unit]
            [filter]
                id=$unit.id
                side=10
            [/filter]
            [variables]
                rebelleaderid=$second_unit.id
            [/variables]
        [/modify_unit]
    [/event]
    
#-----------------